# Areas.wotw: defines logic paths for the wotw randomizer

# requirement macros. must go at the top of the file!
requirement Weapon:
  moki: Sword OR Hammer

requirement EnemyObstacle:  # getting past an uncomfortably placed enemy
  moki: Sword OR Hammer OR Bash OR Launch

requirement ShieldEnemyObstacle:  # getting past a shielded enemy
  moki:
    Sword, Grenade=1 OR Spear=1
    Hammer OR Bash OR Launch

requirement Combat:  # engaging in longer combat sequences
  moki: Regenerate, Sword OR Hammer  # define danger when using this!
  unsafe: Sword OR Hammer

requirement RangedWeapon:
  moki: Grenade=1 OR Bow=1 OR Spear=1

requirement DepthsLight:  # currently irrelevant since defeating mora requires flash in moki, just future proofing here
  moki: UpperDepths.ForestsEyes OR Flash
  unsafe: Bow=3  # should be good, right?

anchor Teleporters:  # teleporter access
  conn MidnightBurrows.Teleporter:
    moki: BurrowsTP, Keystone=2
    # okay, soooo: this TP frequently unlocks exactly 4 pickups (the vanilla keystones in that area)
    # It also makes a 4 keystone door available! Without the Keystone=2 line here, the seed generator
    # picks this path, unlocking 4 pickups, then immediately fills those with keystones and gets stuck
  conn MarshSpawn.Main:
    moki: MarshTP
  conn HowlsDen.Teleporter:
    moki: DenTP
  conn EastHollow.Teleporter:
    moki: HollowTP
  conn GladesTown.Teleporter:
    moki: GladesTP
  conn InnerWellspring.Teleporter:
    moki: WellspringTP
  conn WoodsEntry.Teleporter:
    moki: WestWoodsTP
  conn WoodsMain.Teleporter:
    moki: EastWoodsTP
  conn LowerReach.Teleporter:
    moki: ReachTP
  conn UpperDepths.Teleporter:
    moki: DepthsTP
  conn EastPools.Teleporter:
    moki: EastPoolsTP
  conn WestPools:
    moki: WestPoolsTP
  conn LowerWastes.WestTP:
    moki: WestWastesTP
  conn LowerWastes.EastTP:
    moki: EastWastesTP
  conn UpperWastes.NorthTP:
    moki: OuterRuinsTP
  conn WindtornRuins.RuinsTP:
    moki: InnerRuinsTP
  conn WillowsEnd.InnerTP:
    moki: WillowTP

anchor MarshSpawn.Main at -799, -4310:                  # spawn location / inkwater well
  refill Full

  pickup MarshSpawn.RockHC: free
  pickup MarshSpawn.FirstPickupEX: free
  pickup MarshSpawn.GrappleHC:
    moki:
      Grapple, DoubleJump OR Launch
    gorlek:
      Grapple, SentryJump=1            # Sjump to get to the lower hanging plant
      Grapple, Sword                   # An air combo is enough to get you from the ceiling plant into range of the lower hanging plant
      Grapple, Dash OR Glide           # These also do the trick
  pickup MarshSpawn.BridgeEX:
    moki:
      DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=1                  # Grenade bash straight up from below
  pickup MarshSpawn.LongSwimEX:
    moki: Water
  pickup MarshSpawn.BurrowOre:
    moki:
      Water, Burrow, Bash, DoubleJump OR Glide OR Launch  # Bash for the exploding enemy
      Water, Burrow, Bash, Grenade=1, Dash
  pickup MarshSpawn.LifepactShard:
    # Damage required:
    # Spider: 31 Health
    # Hornbug: 40 Health
    # 2 Sandworms: 20 Health
    # 2 Lizards: 24 Health
    # 3 Skeetos: 20 Health
    # 1 Sneeze Slug: 31 Health
    moki, Combat, Danger=40:  # no region danger
      Water, Burrow, DoubleJump OR Launch
      Water, Burrow, Dash, Bash, Grenade=1
  pickup PoolsApproach.BurrowsPathEX:
    moki:
      DoubleJump, Bash, Glide
      Bash, Launch

  conn Teleporters: free
  conn MarshSpawn.BrokenBridge: free
  conn MarshSpawn.PoolsBurrowsPath:
    moki:
      Water, Burrow, DoubleJump OR Glide OR Launch
      Water, Burrow, Dash, Bash, Grenade=1
  conn MarshPastOpher.MillView:
    moki: BreakWall=16
  conn PoolsApproach.LeftOfWheel:
    moki:
      Water, DoubleJump, Bash, Glide
      Water, Bash, Launch

anchor MarshSpawn.BrokenBridge at -643, -4352:  # after dropping down the breaking bridge
  refill Checkpoint

  pickup MarshSpawn.ResilienceShard:
    moki: BreakWall=16
  pickup MarshSpawn.ResilienceOre:
    moki: BreakWall=16, Water
  pickup MarshSpawn.BashEC:
    moki: Bash OR Launch
  pickup MarshSpawn.PreLupoEX: free
  pickup MarshSpawn.LupoMap: free

  conn MarshSpawn.CaveEntrance: free

anchor MarshSpawn.CaveEntrance at -588, -4393:  # before the door blocking regen tree
  refill Checkpoint

  state MarshSpawn.KeystoneDoor:
    moki: Keystone=2

  pickup MarshSpawn.LeverEC:  # the enemy here doesn't spawn sometimes
    moki:
      Grapple, DoubleJump, Bash
      Launch, Bash
      Grapple, Launch
      Bash, Grenade=1, DoubleJump
    unsafe:
      Launch                          # Single jump and a launch can reach the ledge offscreen.
      Bash                            # Lure the Jumper, then bash off him

  conn MarshSpawn.DenApproach:
    moki: MarshSpawn.KeystoneDoor
  conn MarshSpawn.BrokenBridge:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=1
  conn MarshSpawn.Cave:
    moki: BreakWall=16

anchor MarshSpawn.Cave at -707, -4419:  # At Tokk in the Cave
  refill Checkpoint
  refill Health=1: free

  quest MarshSpawn.CaveKS:
    moki:
      DoubleJump, Dash OR Grapple
      Bash, DoubleJump OR Dash OR Glide OR Grapple
      Launch
      Weapon  # go through the fight room
  quest MarshSpawn.TheMissingKey:
    moki: MarshSpawn.CaveKS

  pickup MarshSpawn.LeftTokkEX:
    moki: BreakWall=10
  pickup MarshSpawn.FightRoomEX:
    moki: BreakWall=10

  conn MarshSpawn.CaveEntrance:
    unsafe: Hammer  # break the wall from behind
  conn MarshSpawn.PoolsBurrowsPath:
    moki:
      DoubleJump, Dash OR Grapple
      Bash, DoubleJump OR Dash OR Glide OR Grapple
      Launch
      Weapon, DoubleJump OR Dash OR Launch  # go through the fight room
      Weapon, Bash, Grenade=1  # go through the fight room

anchor MarshSpawn.PoolsBurrowsPath at -898, -4436:  # the waypoint between pools, burrows and marsh
  refill Checkpoint
  refill Energy=1:
    unsafe: Weapon  # slightly out of sight

  quest MarshSpawn.CaveKS: free
  quest MarshSpawn.IntoTheBurrows:
    moki:
      MidnightBurrows.TabletQI, Bash, DoubleJump OR Dash OR Launch

  pickup MarshSpawn.CaveOre:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=1
  pickup MarshSpawn.BurrowOre:
    moki, EnemyObstacle:
      Burrow, DoubleJump, Dash OR Glide
      Burrow, DoubleJump, Bash, Grenade=1
      Burrow, Launch
    unsafe:
      Burrow, DoubleJump OR Dash
  pickup MarshSpawn.LifepactShard:
    # Damage required:
    # Spider: 31 Health
    # Hornbug: 40 Health
    # 2 Sandworms: 20 Health
    # 2 Lizards: 24 Health
    # 3 Skeetos: 20 Health
    # Sneeze Slug: 31 Health
    moki: Combat, Danger=40, DoubleJump, Burrow  # no region danger
  pickup MarshSpawn.BurrowsApproachLedgeEX:
    moki: Bash, DoubleJump OR Launch
  pickup MarshSpawn.CrusherSwimEX:
    moki: Water, WaterDash, Bash, DoubleJump OR Dash OR Launch
  pickup MarshSpawn.DamageTree:
    moki:
      Bash, DoubleJump, Glide
      Bash, Launch

  conn MidnightBurrows.Teleporter:
    moki: Bash, DoubleJump OR Dash OR Launch
  conn MarshSpawn.Cave: free
  conn MarshSpawn.Main:
    moki, EnemyObstacle:
      Water, Burrow, DoubleJump, Dash OR Glide
      Water, Burrow, Launch

anchor MarshSpawn.DenApproach at -540, -4406:  # at regen tree
  state MarshSpawn.KeystoneDoor:
    moki: Keystone=2
  state MarshSpawn.HowlBurnt:
    moki:
      DoubleJump OR Launch
      Dash, Glide
      Bash, Grenade=1

  pickup MarshSpawn.RegenTree: free
  pickup MarshSpawn.RecklessShard:
    moki, BreakWall=10:
      DoubleJump OR Launch
      Dash, Glide
      Bash, Grenade=1

  conn HowlsDen.Entrance:
    moki, MarshSpawn.HowlBurnt:
      DoubleJump OR Launch
      Dash, Glide
      Bash, Grenade=1
    unsafe, MarshSpawn.HowlBurnt:
      Sword OR Hammer         # Use air combos to make it to wall above thorns
  conn MarshSpawn.CaveEntrance:
    moki, MarshSpawn.KeystoneDoor:
      DoubleJump, Dash, Bash, Glide  # not sorry
      Bash, Grenade=1
      Launch
      MarshSpawn.RainLifted, DoubleJump  # the platform only spawns once you lift the rain

anchor HowlsDen.Entrance at -390, -4413:  # Next to Mokk the Brave after chasing off Howl
  quest MarshSpawn.FangQI:
    moki:
      DoubleJump OR Launch
      Bash, Dash                      # Bash off the enemy to get to the vine, then jump&dash right
    gorlek:
      Bash, Damage=10                 # Bash off the enemy to get to the vine, then jump right. Dboost the last gap.
      Bash, Grenade=1                 # Bash off the enemy to get to the vine, then jump right. Bash+Grenade the last gap.
  quest MarshSpawn.ALittleBraver:
    moki: MarshSpawn.FangQI

  pickup MarshSpawn.FangEC:
    moki:
      DoubleJump, Dash                # Stick to the ceiling
      Launch
    gorlek:
      Bash, Grenade=1, Dash           # Bash up off the enemy and Dash to the fang. Grenade+bash up from the fang
      Bash, Grenade=1, Sword          # As above, but sword upslash to cross the last gap
      Bash, Grenade=1, Damage=10      # As above, but take a dboost on the last gap
  pickup MarshSpawn.RecklessShard:
    moki, MarshSpawn.HowlBurnt, BreakWall=10:
      DoubleJump OR Launch
      Bash, Grenade=1
  pickup HowlsDen.UpperEX: free
  pickup HowlsDen.RightHC:
    moki: BreakWall=16

  conn HowlsDen.BoneBridge: free
  conn MarshSpawn.DenApproach:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=1

anchor HowlsDen.BoneBridge at -371, -4468:  # After the long drop into Howl's Den
  refill Checkpoint

  state HowlsDen.KeystoneDoor:
    moki: Keystone=2
  state MarshSpawn.RainLifted: free  # the sword tree

  pickup HowlsDen.BoneOre:
    moki: Hammer OR Spear=1
  pickup HowlsDen.AboveDoorKS:
    moki: DoubleJump OR Launch
  pickup HowlsDen.LeftHC:
    moki: HowlsDen.KeystoneDoor, EnemyObstacle, BreakWall=20, DoubleJump OR Dash OR Launch
  pickup HowlsDen.RightHC:
    moki, HowlsDen.KeystoneDoor:
      BreakWall=16, BreakWall=16, BreakWall=20, DoubleJump OR Launch
      BreakWall=16, BreakWall=16, BreakWall=20, Dash, Bash, Grenade=1
  pickup HowlsDen.UpperEX:
    moki, HowlsDen.KeystoneDoor:
      # breaking one wall
      Launch, BreakWall=16
      # breaking all walls (this is good syntax!)
      BreakWall=16, BreakWall=16, BreakWall=16, DoubleJump
      BreakWall=16, BreakWall=16, BreakWall=16, Dash, Bash, Grenade=1
  pickup HowlsDen.SwordTree: free
  pickup HowlsDen.MagnetShard:
    moki: BreakWall=10, BreakWall=16 OR Launch
  pickup HowlsDen.AboveTPEX:
    moki: BreakWall=16, BreakWall=10

  conn HowlsDen.Teleporter:
    moki: BreakWall=16
  conn HowlsDen.Entrance:
    moki, HowlsDen.KeystoneDoor, MarshSpawn.HowlBurnt:  # the path is blocked if howl fight is not done
      # breaking one wall
      Launch, BreakWall=16
      # breaking all walls (this is good syntax!)
      BreakWall=16, BreakWall=16, BreakWall=16, DoubleJump
      BreakWall=16, BreakWall=16, BreakWall=16, Dash, Bash, Grenade=1

anchor HowlsDen.Teleporter at -328, -4536:  # At the teleporter
  refill Full

  pickup HowlsDen.AboveTPEX:
    moki, BreakWall=10:
      DoubleJump OR Launch
      Bash  # bash the slime
  pickup HowlsDen.LaserKS:
    moki:
      DoubleJump OR Dash OR Launch
      Bash, Grenade=1
    unsafe:
      Sword OR Hammer         # Can reach lever with air combos
  # if someone manages to lower the platform, they'll manage to get over the gap as well. That's how it works in the base game, that's how it'll work here
  pickup HowlsDen.DoubleJumpEX:
    # Damage required:
    # Squonkey: 31 Health
    # Lizard: 24 Health
    moki: Weapon  # no combat because the game puts this before regen. It's why all the enemies drop tons of health

  conn Teleporters: free
  conn DenShrine:
    moki: Hammer OR Spear=1
  conn HowlsDen.DoubleJumpTreeArea:
    # Damage required:
    # Squonkey: 31 Health
    # Lizard: 24 Health
    moki: Weapon OR DoubleJump OR Dash OR Glide OR Launch
  conn HowlsDen.BoneBridge:
    unsafe: Hammer  # break a wall from behind

anchor DenShrine:
  refill Full
  pickup HowlsDen.CombatShrine:
    # Wave Refill: 4 Energy
    # Damage required:
    # Wave 1:
    # Squonkey: 31 Health
    # 2 Lizards: 24 Health
    # Wave 2:
    # 2 Sneeze Slugs: 31 Health
    # Squonkey: 31 Health
    # Skeeto: 20 Health
    # Wave 3:
    # 7 Skeeties: 8 Health
    # 2 Skeetos: 20 Health
    # Wave 4:
    # 2 Lizards: 24 Health
    # 2 Squonkeys: 31 Health
    moki, Combat, DoubleJump OR Bash OR Launch:  # pretty difficult shrine actually
      Danger=60
      Danger=40, Dash OR Bash OR Launch  # much better if you have good evasion

anchor HowlsDen.DoubleJumpTreeArea at -555, -4552:  # At the Double Jump Tree
  pickup HowlsDen.DoubleJumpTree: free
  pickup HowlsDen.StickyShard: free  # origlow
  pickup HowlsDen.DoubleJumpEX:
    moki:
      DoubleJump, Bash  # not the most cooperative enemy, which is why there are assisting abilities
      Bash, Grenade=1, Dash OR Glide  # not the most cooperative enemy, which is why there are assisting abilities
      Launch

  conn HowlsDen.Teleporter:
    moki:
      DoubleJump
      Bash, Grenade=1, Dash OR Glide
      Launch

anchor MarshPastOpher.MillView at -596, -4293:  # Standing next to Opher, looking at the Millstone
  refill Checkpoint
  refill Energy=3:
    moki: Weapon  # to the left

  pickup MarshPastOpher.TrialLeftEX:
    moki: BreakWall=20, DoubleJump OR Glide OR Dash OR Launch
    unsafe: Sword OR Hammer  # horizontal slash combo

  conn OpherShop: free
  conn MarshPastOpher.TrialArea:
    moki: BreakWall=20
  conn MarshPastOpher.BowPath:
    moki: DoubleJump OR Dash OR Glide OR Launch
  conn MarshSpawn.Main:
    unsafe: Hammer  # break the wall from behind and use an upswing

anchor MarshPastOpher.TrialArea at -427, -4343:  # Next to the shrine
  refill Checkpoint
  refill Health=1:  # right below
    moki: DoubleJump OR Dash OR Glide OR Launch

  # state MarshPastOpher.TrialActivation:
  #   moki: Grapple, Dash OR Glide OR Launch

  pickup MarshPastOpher.TrialLeftEX:
    moki:
      DoubleJump, Dash OR Glide
      Dash, Glide
      Grapple OR Launch
  pickup MarshPastOpher.TrialOre: free
  pickup MarshPastOpher.TrialEC:
    moki: DoubleJump OR Dash OR Glide OR Launch
    unsafe: Sword OR Hammer
  pickup MarshPastOpher.TrialHC:
    moki: Hammer OR Spear=1
    unsafe: free  # lure stomp
  pickup MarshPastOpher.TrialRightEX:
    moki: DoubleJump OR Bash OR Launch  # bash uses the enemy
    unsafe: Sword  # pogo off of enemy

  conn MarshShrine: free

anchor MarshShrine:
  refill Full
  pickup MarshPastOpher.CombatShrine:
    # Wave Refill: 2 Energy
    # Damage required:
    # Wave 1:
    # 2 Skeetos: 20 Health
    # Wave 2:
    # Squonkey: 31 Health
    # 4 Skeeties: 8 Health
    # Wave 3:
    # Squonkey: 31 Health
    # Skeeto: 20 Health
    moki: Combat, Danger=20, DoubleJump OR Bash OR Launch  # flying enemies, but short and not too hard

anchor MarshPastOpher.BowPath at -494, -4294:  # checkpoint climbing up to Bow tree
  refill Checkpoint
  refill Health=1: free
  refill Energy=1:
    moki: Weapon

  pickup MarshPastOpher.SwingPoleEX:
    moki:
      Danger=10, DoubleJump OR Dash OR Glide OR Launch
      Danger=10, Bash, Grenade=1
    unsafe: Sword OR Hammer OR DoubleJump OR Dash OR Launch OR Bash OR Glide  # it's notably harder to get without taking a hit. Up and/or Side combos with sword or hammer can make it to the horizontal branch from the launch pad.

  conn MarshPastOpher.BowArea:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=3
    unsafe: Sword OR Hammer
  conn MarshPastOpher.MillView:
    moki:
      DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=2
  conn MarshPastOpher.TrialArea:
    moki: BreakWall=20, Danger=10  # the one-way has 20 health as well, so there might not be relevant shurikenbreak paths here

anchor MarshPastOpher.BowArea at -443, -4236:  # Ledge to the left of the pit with bow tree.
  refill Energy=1:
    moki: Weapon

  state MarshPastOpher.EyestoneDoor:
    moki: Keystone=2

  pickup MarshPastOpher.BowEC: free
  pickup MarshPastOpher.BowTree: free
  pickup MarshPastOpher.SwingPoleEX:
    moki: Danger=20

  conn MarshPastOpher.UpperBowArea:
    moki, EnemyObstacle:
      Bow=2, DoubleJump
      Launch
  conn MarshPastOpher.MillView:
    moki:
      DoubleJump OR Dash OR Launch
      Glide, Danger=10
      Bash, Grenade=1, Bow=1
      Bash, Grenade=2
  conn MarshPastOpher.PoolsPathEast:
    moki:
      Bow=4, DoubleJump, Dash, Bash, Glide  # autoaim doesn't catch the second target, 2 is needed minimum
      Bow=4, Bash, Launch  # autoaim doesn't catch the second target, 2 is needed minimum
  conn WestHollow.Entrance:
    moki: MarshPastOpher.EyestoneDoor

anchor MarshPastOpher.UpperBowArea at -437, -4211:  # Between the eyestones
  refill Checkpoint
  refill Energy=1:
    moki: Weapon

  pickup MarshPastOpher.LeftEyestone:
    moki: EnemyObstacle, Bow=1
  pickup MarshPastOpher.RightEyestone:
    moki: EnemyObstacle, Bow=1

  conn MarshPastOpher.BowArea: free
  conn MarshPastOpher.BowPath: free
  conn MarshPastOpher.MillView:
    moki: Bash, Grenade=1

anchor MarshPastOpher.PoolsPathEast at -662, -4241:  # On the wood sticking out of the ledge at the top left of the large room with Opher
  refill Checkpoint
  refill Health=1:
    moki: EnemyObstacle
  refill Energy=3:
    moki: Weapon

  pickup MarshPastOpher.CeilingEX:
    moki:
      Bash, DoubleJump, Dash
      Launch
    unsafe:
      Bash, Dash              # Pretty precise to do without damage
  pickup MarshPastOpher.PoolsPathEC:  # the squonkey doesn't reappear if you respawn on this checkpoint
    moki: Bash, DoubleJump OR Launch
    unsafe: Bash, Glide

  conn MarshPastOpher.PoolsPathWest:  # the squonkey doesn't reappear if you respawn on this checkpoint
    moki: Bash, DoubleJump OR Launch
    unsafe:
      Hammer, Bash                    # Fairly precise air combos needed
      Hammer, Sword, Bash             # Fairly precise air combos needed
  conn MarshPastOpher.MillView: free

anchor MarshPastOpher.PoolsPathWest at -803, -4187:  #  Right on top of MarshPastOpher.PoolsPathEX
  refill Checkpoint

  pickup MarshPastOpher.PoolsPathEX: free
  pickup MarshPastOpher.PoolsPathEC:
    moki, BreakWall=20:
      DoubleJump, Bash, Dash OR Glide
      Bash, Grenade=1, Dash, Glide
      Launch, DoubleJump OR Dash OR Bash OR Glide

  conn MarshPastOpher.PoolsPathEast:
    moki, BreakWall=20:
      DoubleJump, Bash, Dash OR Glide
      Bash, Grenade=1, Dash, Glide
      Launch, Danger=10, DoubleJump OR Dash OR Glide
      Launch, Bash

region MidnightBurrows:
  moki: Danger=25 # kind of a no-op?
  unsafe: free

anchor MidnightBurrows.Teleporter at -945, -4582:  # At the teleporter
  refill Full

  pickup MidnightBurrows.LeftKS:
    moki: DoubleJump OR Dash OR Glide OR Launch
    unsafe: Damage=15
  pickup MidnightBurrows.LupoMap:
    moki: Launch  # paths coming from the right side are on that anchor
    unsafe: Bash

  conn Teleporters: free
  conn MidnightBurrows.Central:
    moki: DoubleJump OR Launch

anchor MidnightBurrows.Central at -781, -4564:  # The ledge left of the big portal room
  refill Checkpoint

  quest MidnightBurrows.TabletQI:
    moki, MidnightBurrows.KeystoneDoor:
      Bash, DoubleJump OR Dash OR Glide
      Launch

  state MidnightBurrows.KeystoneDoor:
    moki, Keystone=4:
      Bash, DoubleJump OR Dash OR Glide
      Launch
  state MidnightBurrows.Lever:
    moki:
      Glide
      DoubleJump, Dash
      Bash, DoubleJump OR Dash
      Launch, DoubleJump OR Dash OR Bash

  pickup MidnightBurrows.LupoMap:
    moki: DoubleJump OR Dash OR Glide
  pickup MidnightBurrows.DeflectorShard:
    moki:
      MidnightBurrows.Lever, DoubleJump, Dash OR Glide
      Launch
    unsafe:
      MidnightBurrows.Lever, DoubleJump OR Dash
  pickup MidnightBurrows.LowerKS:
    moki:
      DoubleJump, Dash OR Glide
      Dash, Glide
      Bash, Grenade=1, DoubleJump OR Dash OR Glide
      Launch, DoubleJump OR Dash OR Bash OR Glide
  pickup MidnightBurrows.UpperKS:
    moki: MidnightBurrows.Lever, Launch  # paths coming from the right side are on that anchor

  conn MidnightBurrows.Teleporter: free
  conn MidnightBurrows.East:
    moki:
      MidnightBurrows.Lever, DoubleJump OR Dash OR Glide
      Bash, Grenade=3, DoubleJump OR Dash OR Glide  # you never need the whole set, but this is for both states of portals lifted
      Launch

anchor MidnightBurrows.East at -597, -4549:  # At the wall connecting to Den
  refill Checkpoint

  pickup MidnightBurrows.RightKS: free
  pickup MidnightBurrows.UpperKS:
    # Damage required:
    # Slug: 12 Health
    moki, EnemyObstacle:
      DoubleJump, Glide
      DoubleJump, Dash, Danger=15
      Launch, DoubleJump OR Dash OR Glide OR Danger=15

  conn MidnightBurrows.Central:
    # Damage required:
    # Slug: 12 Health
    moki, EnemyObstacle:
      DoubleJump, Glide
      DoubleJump, Dash, Danger=15
      Launch, DoubleJump OR Dash OR Glide OR Danger=15
  conn HowlsDen.DoubleJumpTreeArea:
    moki: BreakWall=10

region WestHollow:
  moki: Danger=20
  unsafe: free

anchor WestHollow.Entrance at -303, -4238:  # At Twillen
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  state WestHollow.UpperDrainLeverPulled:  # Lever that drains the first section of the hollow
    moki:
      Weapon, Bow=4, DoubleJump OR Dash  # the camera only reliably moves to the tongues if you can kill the slimes
      Bash, Bow=2  # bashing up with the slime
      RangedWeapon, DoubleJump, Dash, Glide
      RangedWeapon, Bash, DoubleJump, Dash OR Glide  # bashing up with the slime
      Launch
  state WestHollow.PurpleDoorOpen:
    moki, WestHollow.UpperDrainLeverPulled:
      Bow=1, DoubleJump, Dash
      Bow=1, Launch
      Bow=1, Bash, Grenade=1
    unsafe, WestHollow.UpperDrainLeverPulled:
      Bow=1, Glide, DoubleJump OR Dash

  pickup WestHollow.CrusherHC: free

  conn TwillenShop: free
  conn MarshPastOpher.BowArea:
    moki, MarshPastOpher.EyestoneDoor:
      DoubleJump OR Launch
      Bash, Grenade=1
  conn EastHollow.Teleporter:
    moki, WestHollow.PurpleDoorOpen:
      Weapon, Bow=1, DoubleJump OR Dash OR Glide  # the camera only reliably moves to the tongue if you can kill the slime
      DoubleJump, Dash OR Glide
      Bash, RangedWeapon OR DoubleJump OR Dash OR Glide  # bashing up with the slime
      Launch
  conn WestHollow.HollowDrainMiddle:
    moki: WestHollow.UpperDrainLeverPulled

anchor WestHollow.HollowDrainMiddle:  # At the crystal below the purple eye (at -197, -4275; coordinates omitted because this is not a valid warp/spawn target)
  refill Checkpoint
  refill Energy=3:
    moki: WestHollow.UpperDrainLeverPulled, Weapon
  refill Energy=1:  # no matter which direction you come to or go from here, you should be able to grab this crystal without having to go back
    moki: WestHollow.FullyDrained, Weapon

  # this anchor doesn't assume drained water because that should make it usable for weird dirty water swim paths
  pickup WestHollow.HiddenEC:
    moki: WestHollow.FullyDrained, BreakWall=10

  conn WestHollow.RockPuzzle:
    moki, WestHollow.UpperDrainLeverPulled:
      Bow=2, DoubleJump OR Dash
      DoubleJump, Dash
      Glide OR Launch
      # fully drained paths seem kind of irrelevant?
  conn WestHollow.HollowDrainLower:
    moki: WestHollow.FullyDrained
  conn WestHollow.Entrance:
    moki, WestHollow.UpperDrainLeverPulled:
      DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=1

anchor WestHollow.RockPuzzle:  # At the right ledge of the rock puzzle room (at -249, -4275; coordinates omitted because this is not a valid warp/spawn target)
  refill Checkpoint
  refill Energy=3:
    moki: Weapon, DoubleJump OR Dash OR Bash OR Glide OR Launch

  state WestHollow.RockPuzzleSolved:  # You can get the puzzle into some weird constellations, but teleporting out works in the worst cases
    moki, WestHollow.UpperDrainLeverPulled, EnemyObstacle:  # EnemyObstacle provides solutions to shoot with the skeeto around
      Bow=4, DoubleJump OR Dash OR Bash OR Glide OR Launch
      Bow=4, Bash, Grenade=1

  pickup WestHollow.RockPuzzleEX:
    moki: WestHollow.FullyDrained
    unsafe: WestHollow.UpperDrainLeverPulled, Damage=100
  pickup WestHollow.HiddenEC:
    moki: WestHollow.FullyDrained, BreakWall=10

  conn WestHollow.FarLeftRoom:
    moki, WestHollow.UpperDrainLeverPulled, WestHollow.RockPuzzleSolved, EnemyObstacle:
      Bow=1, DoubleJump OR Dash
      Bash OR Launch  # bashing off the skeeto
  conn WestHollow.HollowDrainMiddle:
    moki:
      Launch, DoubleJump OR Dash OR Glide OR Bow=1
      WestHollow.FullyDrained, Bow=3, DoubleJump  # one for the slime, two for the tongues
      WestHollow.FullyDrained, Bash, Grenade=1
      WestHollow.FullyDrained, Launch
  conn WestHollow.HollowDrainLower:
    moki: WestHollow.FullyDrained

anchor WestHollow.FarLeftRoom at -357, -4284:  # ledge below and to the right of second drain lever
  refill Energy=3:  # fast respawning crystal
    moki: Weapon
  # energy crystal below not considered because it doesn't seem relevant for anything

  state WestHollow.FullyDrained:
    moki, WestHollow.UpperDrainLeverPulled:
      Bow=2, DoubleJump OR Dash OR Glide
      Launch

  pickup WestHollow.FarLeftEX:
    moki, WestHollow.FullyDrained:
      Bash OR Launch
      Bow=1, DoubleJump, Dash
  # backwards connection blocked by the door

anchor WestHollow.HollowDrainLower at -216, -4329:  # Next to the jumppad left of Lupo
  refill Checkpoint

  pickup WestHollow.QuickshotShard:
    moki: WestHollow.FullyDrained, EnemyObstacle, DoubleJump, Bow=1, Dash OR Launch  # middle water state can softlock this, so you have to be able to fully lower the water. DoubleJump is for lenience on the bowshot
  pickup WestHollow.SwimEC:
    moki: Water
  pickup WestHollow.LupoMap:
    moki:  # All the path options here include a way to get past the enemy
      DoubleJump, Dash
      Bash  # bash off the slug
      Launch
  pickup WestHollow.TrialHC:
    moki, WestHollow.FullyDrained, EnemyObstacle:  # middle water state can softlock this, so you have to be able to fully lower the water.
      DoubleJump, Dash OR Glide
      DoubleJump, Bash  # bash off the skeetos
      Launch
  pickup WestHollow.BelowLupoEX:
    moki:  # All the path options here include a way to get past the enemies
      DoubleJump, Dash
      Launch

  conn WestHollow.Lower:
    moki: EnemyObstacle OR DoubleJump
  # no backwards connection through the water

anchor WestHollow.Lower at -111, -4429:  # To the left of the lever door
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  # state WestHollow.TrialActivation:
  #   moki, EnemyObstacle:
  #     DoubleJump OR Dash OR Launch
  #     Bash, Grenade=1
  state WestHollow.DoorLever:  # The door blocking Dash area
    moki, EnemyObstacle:
      DoubleJump OR Dash OR Launch
      Bash, Grenade=1

  conn WestHollow.HollowDrainLower:
    moki, EnemyObstacle:
      DoubleJump, Dash
      Bash, Grenade=2, DoubleJump OR Dash
      Launch
  conn WestHollow.DashArea:
    moki: WestHollow.DoorLever, EnemyObstacle OR DoubleJump

anchor WestHollow.DashArea at -88, -4423:  # To the right of the lever door
  refill Checkpoint

  pickup WestHollow.DashTree: free
  pickup WestHollow.CrusherEX:
    moki: Dash
    unsafe: Launch
  pickup WestHollow.DashRightEX:
    moki:
      DoubleJump, Dash
      Launch
  pickup WestHollow.AboveDashEX:
    moki:  # there's some funny Bashgrenade paths here, but they're not moki-safe
      DoubleJump, Dash
      Launch

  # backwards connections pointless with the lever

region EastHollow:
  moki: Danger=20
  unsafe: free

anchor EastHollow.Teleporter at -150, -4238:  # the teleporter
  refill Full

  # paths through the purple door exist mainly because of historical reasons, but might be a candidate for future open mode as well
  state WestHollow.UpperDrainLeverPulled:  # Lever that drains the first section of the hollow
    moki, WestHollow.PurpleDoorOpen:
      Weapon, Bow=3, DoubleJump OR Dash  # the camera only reliably moves to the tongue if you can kill the slime
      RangedWeapon, DoubleJump, Dash, Glide
      Launch

  conn Teleporters: free
  conn BeetleFight: free
  conn EastHollow.AboveBash:
    moki: EnemyObstacle, EastHollow.BeetleDefeated  # Didn't consider avoiding the beetle fight for moki, so this connection should cover all paths going up
    unsafe:
      Bash, Glide OR Dash OR DoubleJump
      Launch
  conn WestHollow.Entrance:
    moki, WestHollow.PurpleDoorOpen:
      WestHollow.UpperDrainLeverPulled OR Bow=1 OR DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=1
  conn WestHollow.HollowDrainMiddle:
    moki: WestHollow.PurpleDoorOpen, WestHollow.UpperDrainLeverPulled

anchor BeetleFight:
  refill Full
  state EastHollow.BeetleDefeated:
    moki: Combat, Danger=35, Dash OR Launch  # Kinda tight on danger, but that's literally what the base game throws you at. It isn't too difficult to avoid the beetle's attacks without Dash, but this is what the base game taught.
    unsafe: Combat

anchor EastHollow.AboveBash at -28, -4233:  # At the breakable floor to Bash tree
  refill Checkpoint

  state EastHollow.DepthsLever:
    moki: Bash, DoubleJump OR Dash OR Glide OR Launch  # just Bash is treacherous
  state GladesTown.EntryWallBroken:  # for the shop unlocks
    moki: EastHollow.BeetleDefeated, EastHollow.Voice, Bash, DoubleJump OR Launch
    unsafe: EastHollow.Voice, Bash, DoubleJump OR Launch

  quest EastHollow.HandToHandMap:
    moki, EastHollow.BeetleDefeated, EastHollow.Voice:
      Bash, DoubleJump OR Dash OR Glide
      Launch
    unsafe:
      Bash, DoubleJump OR Dash OR Glide
      Launch
      EastHollow.BeetleDefeated, DoubleJump, Dash, Glide

  pickup EastHollow.GladesApproachOre:
    moki: EastHollow.BeetleDefeated, EastHollow.Voice, Bash, DoubleJump OR Dash OR Glide OR Launch
    unsafe: EastHollow.Voice, Bash, DoubleJump OR Dash OR Glide OR Launch
  pickup EastHollow.HornBeetleFightEX:
    moki, EastHollow.BeetleDefeated:
      DoubleJump, Dash, Bash
      Bash, Grenade=1, DoubleJump OR Dash OR Glide  # the nearby skeeto loses interest in you if you go to the ledge below this pickup
      Launch
    unsafe:
      DoubleJump, Dash, Bash
      Bash, Grenade=1, DoubleJump OR Dash OR Glide  # the nearby skeeto loses interest in you if you go to the ledge below this pickup
      Launch
  pickup EastHollow.SpikeLanternEX:
    moki: DoubleJump, Bash  # there's a couple small awkward things adding up if you do this without Double Jump
  pickup EastHollow.SecretRoofEX:
    moki:
      Bash OR Launch
      Grapple, DoubleJump, Dash OR Glide
  pickup EastHollow.MortarEX:
    moki: Bash OR Launch  # Bash only needs some slight creativity, but there are many ways to solve it
  pickup EastHollow.BashEC:
    moki:
      Bash, DoubleJump, Dash
      Bash, Grenade=1
      Launch
    gorlek:
      SentryJump=3
  pickup EastHollow.BashTree:
    moki:
      EnemyObstacle, DoubleJump OR Dash
      Glide OR Launch
  pickup EastHollow.BashEX:
    moki:
      DoubleJump, Bash
      Launch

  conn BeetleFight: free
  conn EastHollow.Teleporter:
    moki, EastHollow.BeetleDefeated:
      DoubleJump, Dash
      Bash, DoubleJump OR Dash OR Grenade=1
      Glide OR Launch
  conn GladesTown.Teleporter:  # using the wall state here could have relevance if it was to fall under some open mode
    moki: EastHollow.BeetleDefeated, EastHollow.Voice, GladesTown.EntryWallBroken, Bash, DoubleJump OR Launch
    unsafe: EastHollow.Voice, GladesTown.EntryWallBroken, Bash, DoubleJump OR Launch
  conn EastHollow.AboveDepths:
    moki: EastHollow.DepthsLever, EnemyObstacle, DoubleJump OR Dash OR Glide OR Launch  # just Bash is treacherous
  conn EastHollow.Kwolok:
    moki:
      Bash, DoubleJump OR Dash OR Glide OR Launch
      Launch, DoubleJump, Dash OR Glide
      Launch, Dash, Glide

anchor EastHollow.Kwolok at 177, -4215:  # Between Ku and Kwolok
  refill Checkpoint

  state EastHollow.Voice: free

  quest EastHollow.KwoloksWisdom:
    moki: EastPools.KwoloksWisdomAmulet, WestPools.ForestsStrength

  pickup EastHollow.RightKwolokEX:
    moki: Bash OR Launch
  pickup EastHollow.SilentSwimEC:
    moki: Water, WaterDash OR Launch
  pickup EastHollow.KwolokSwimOre:
    moki: Water, Bash OR Danger=10  # enemy in the way
  pickup EastHollow.KwolokSwimLeftEX:
    moki: Water, WaterDash OR Launch
  pickup EastHollow.KwolokSwimRightEX:
    moki: Water

  conn EastHollow.AboveBash:
    moki:  # since the ability culprit is right at the start, these should account for paths to the pickups on the way
      Bash, DoubleJump OR Dash OR Glide
      DoubleJump, Dash OR Glide
      Dash, Glide, Danger=10
      Launch
  conn WoodsEntry.ShriekMeet:
    moki:
      Water, Launch
      Water, Grapple, DoubleJump, Dash OR Glide
      Water, Grapple, Dash, Glide

anchor EastHollow.AboveDepths at 47, -4302:  # To the right of the lever door blocking Depths access
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  pickup EastHollow.BashHC:
    moki: Bash OR Launch
  pickup EastHollow.SplinterShard: free
  pickup EastHollow.DepthsExteriorEX:
    moki: Glide, Launch  # ...what even is intended here?

  conn UpperDepths.Entry:
    moki: Glide
  # backwards paths through the door seem pointless

anchor GladesTown.Teleporter at -307, -4153:  # The glades teleporter
  refill Full

  state GladesTown.BuildHuts:
    moki: Ore=15
  state GladesTown.RoofsOverHeads:
    moki: GladesTown.BuildHuts, Ore=21
  state GladesTown.OnwardsAndUpwards:
    moki: GladesTown.RoofsOverHeads, Ore=29
  state GladesTown.ClearThorns:
    moki: Ore=23
  state GladesTown.CaveEntrance:
    moki: GladesTown.ClearThorns, Ore=29
  # decoration not accounted for
  # state GladesTown.RatherPlay:  # talking to the Moki that allows to build decoration
  #   moki:
  #     Flap, Glide
  #     Launch
  #     TuleyShop.Lightcatchers, Bash:
  #       Grenade=1
  #       TuleyShop.BlueMoon, Grapple, DoubleJump OR Dash
  #       TuleyShop.StickyGrass, Grapple, DoubleJump OR Dash
  #       TuleyShop.SpringPlants
  #     TuleyShop.SpringPlants, DoubleJump
  #     GladesTown.RoofsOverHeads:
  #       Bash, Grenade=2
  #       TuleyShop.BlueMoon, Grapple, Bash, Grenade=1
  #       TuleyShop.SpringPlants, Bash, Grenade=1

  # silent woods map quest doesn't exactly make sense
  quest GladesTown.HandToHandPouch:
    moki: EastHollow.HandToHandMap
  quest GladesTown.RebuildTheGlades:
    moki: Ore=40

  pickup GladesTown.UpdraftCeilingEX:
    moki:
      Flap, Glide
      Bash, Grenade=1, DoubleJump
      Launch
      TuleyShop.Lightcatchers, Bash, Grenade=1
      TuleyShop.BlueMoon, DoubleJump, Grapple
      TuleyShop.BlueMoon, TuleyShop.Lightcatchers, Bash, Grapple
      TuleyShop.SpringPlants, DoubleJump OR Dash OR Glide
      TuleyShop.SpringPlants, TuleyShop.Lightcatchers, Bash
    unsafe: Bash, Grenade=2
  pickup GladesTown.AboveTpEX:
    moki:
      Launch  # probably fine?
      TuleyShop.Lightcatchers, Bash:
        Grenade=1
        DoubleJump, Flap, Glide
        TuleyShop.StickyGrass, Grapple
        TuleyShop.BlueMoon, DoubleJump, Grapple
        TuleyShop.SpringPlants, DoubleJump
    unsafe:
      Bash, Grenade=2, Dash, DoubleJump
  pickup GladesTown.BountyShard:
    moki:
      Launch  # probably fine?
      TuleyShop.Lightcatchers, Bash:
        Grenade=1
        DoubleJump, Flap, Glide
        TuleyShop.StickyGrass, Grapple
        TuleyShop.BlueMoon, DoubleJump, Grapple
        TuleyShop.SpringPlants, DoubleJump
    unsafe:
      Bash, Grenade=3, Dash, DoubleJump
  pickup GladesTown.ArcingShard:
    moki, GladesTown.ClearThorns:
      Bash, Grenade=1  # probably fine?
      Launch
      TuleyShop.Lightcatchers, Bash, DoubleJump OR Dash OR Glide
  pickup GladesTown.LupoSoupEX:
    moki: Water OR Burrow
  pickup GladesTown.LupoSwimHC:
    moki: Water, Burrow
  pickup GladesTown.LupoSwimMiddleEX:
    moki: Water, WaterDash OR Launch
  pickup GladesTown.LupoSwimLeftEX:
    moki: GladesTown.ClearThorns, Water, WaterDash OR Launch

  conn Teleporters: free
  conn GladesTown.TwillenHome: free
  conn GladesTown.UpperWest:
    moki:
      Launch, DoubleJump OR Dash OR Glide
      TuleyShop.BlueMoon, Grapple:
        Bash, Grenade=1
        Launch
        TuleyShop.Lightcatchers, Bash, DoubleJump OR Dash OR Glide
  conn GladesTown.HoleHut:
    moki:
      Flap, Glide:
        DoubleJump
        Bash, Grenade=1
        TuleyShop.BlueMoon, Grapple
        TuleyShop.StickyGrass, Grapple, DoubleJump OR Dash
        TuleyShop.SpringPlants
      Launch
      TuleyShop.Lightcatchers, Bash:
        Grenade=2
        Grenade=1, DoubleJump
        TuleyShop.BlueMoon, Grapple, DoubleJump OR Dash
        TuleyShop.BlueMoon, Grapple, Grenade=1, Glide
        TuleyShop.StickyGrass, Grapple, DoubleJump, Dash OR Glide
        TuleyShop.StickyGrass, Grapple, Grenade=1, DoubleJump OR Dash OR Glide
        TuleyShop.SpringPlants
      TuleyShop.SpringPlants, DoubleJump
      GladesTown.RoofsOverHeads:
        Bash, Grenade=3
        DoubleJump, Bash, Grenade=2
        TuleyShop.BlueMoon, Grapple, Bash, Grenade=1, DoubleJump OR Dash
        TuleyShop.BlueMoon, Grapple, Bash, Grenade=2, Glide
        TuleyShop.StickyGrass, Grapple, Bash, Grenade=1, DoubleJump, Dash OR Glide
        TuleyShop.SpringPlants, Bash, Grenade=1
  conn GladesTown.ReachPath:
    moki:
      TuleyShop.Lightcatchers, TuleyShop.StickyGrass, Bash, Grapple, DoubleJump OR Dash  # other paths should be redundant with HoleHut
  conn OpherShop: free
  conn TuleyShop:
    moki, InnerWellspring.WaterEscape
      DoubleJump OR Launch
      Flap, Glide
      Bash, Grenade=1
      # seed paths tbd if ever necessary
# connection to hollow currently redundant with the wall in the way

anchor GladesTown.TwillenHome at -414, -4160:  # # At Twillen in Glades
  refill Checkpoint

  quest GladesTown.HandToHandLantern:
    moki: LowerReach.HandToHandHat
  quest GladesTown.FamilyReunionKey:
    moki: GladesTown.RoofsOverHeads
  quest GladesTown.AcornQI:
    moki, GladesTown.ClearThorns, GladesTown.CaveEntrance, Flash:
      Water, Glide
      Water, DoubleJump, Dash
      Bash, Grenade=1
      Launch
    unsafe: GladesTown.CaveEntrance, Flash, Water, Dash
  quest GladesTown.IntoTheDarkness:
    moki: GladesTown.ClearThorns, GladesTown.AcornQI

  pickup GladesTown.LowerOre:
    moki:
      Hammer, DoubleJump OR Launch OR Dash OR Glide
      Spear=1, DoubleJump OR Launch OR Dash OR Glide
      Bash, Grenade=1, Hammer OR Spear=1
  pickup GladesTown.AboveCaveEX:
    moki: GladesTown.ClearThorns
  pickup GladesTown.CaveBurrowEX:
    moki: GladesTown.ClearThorns, Burrow, DoubleJump OR Launch
  pickup GladesTown.KeyMokiHutEX:
    moki: GladesTown.RoofsOverHeads, WoodsEntry.DollQI
  pickup GladesTown.DamageTree:
    moki: TuleyShop.LastTree

  conn TwillenShop: free
  conn GladesTown.West:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=1
      TuleyShop.StickyGrass, Grapple
  conn GladesTown.Teleporter:
    moki:
      GladesTown.ClearThorns OR DoubleJump OR Launch
      Bash, Grenade=1

anchor GladesTown.West at -430, -4135:  # At Motay
  refill Checkpoint

  quest GladesTown.HandToHandCanteen:
    moki: EastPools.HandToHandSpyglass

  pickup GladesTown.UpperOre:
    moki:
      Bash, Grenade=1, Launch
      Launch, DoubleJump  # different ways to solve this, should be fine...
      TuleyShop.StickyGrass:
        Grapple OR Launch
        Bash, Grenade=1, DoubleJump, Dash OR Glide
        Bash, Grenade=1, Dash, Glide
        TuleyShop.Lightcatchers, Bash, DoubleJump, Dash
        TuleyShop.Lightcatchers, Bash, Glide
      GladesTown.BuildHuts:
        DoubleJump, Bash, Grenade=2
        Bash, Grenade=3
        Launch
        TuleyShop.StickyGrass:
          DoubleJump, Bash, Grenade=1
          TuleyShop.Lightcatchers, Bash, DoubleJump OR Dash OR Glide
        TuleyShop.Lightcatchers, Bash, Grenade=1
  pickup GladesTown.MotayHutEX:
    moki, GladesTown.BuildHuts:
      DoubleJump, Dash OR Glide
      Bash, Grenade=1
      Launch
      Grapple, TuleyShop.StickyGrass OR TuleyShop.BlueMoon
      TuleyShop.Lightcatchers, Bash

  conn WestGlades.Lower:
    moki, EnemyObstacle:
      Bash, DoubleJump OR Dash
      DoubleJump, Dash, Glide  # this path is too nice to not be moki... right?
      Launch
  conn GladesTown.TwillenHome: free
  conn GladesTown.Teleporter:
    moki:
      TuleyShop.Lightcatchers, Bash, Glide
      TuleyShop.BlueMoon, Grapple
      GladesTown.BuildHuts, TuleyShop.StickyGrass, Grapple, Glide
  conn GladesTown.UpperWest:
    moki:
      TuleyShop.StickyGrass, Launch
      TuleyShop.Lightcatchers, Bash:
        DoubleJump, Dash OR Glide
        Dash, Glide
        Launch
        TuleyShop.StickyGrass, Grapple, DoubleJump OR Dash OR Glide
      TuleyShop.BlueMoon, Grapple, DoubleJump OR Dash OR Glide OR Launch  # extra abilities because it's harder if the huts are there
      GladesTown.BuildHuts:
        Bash, Grenade=3  # need an extra grenade if the lightcatcher is there
        Bash, Grenade=1, DoubleJump, Dash OR Glide  # don't need an extra grenade because you can just do the lightcatcher path instead
        Launch
        TuleyShop.Lightcatchers, Bash, DoubleJump OR Dash OR Glide
  # all other paths should be redundant with the connection to tp

anchor GladesTown.UpperWest at -357, -4126:  # Where Mokk lives
  pickup GladesTown.ArcingShard:
    moki, GladesTown.ClearThorns:
      DoubleJump OR Dash OR Glide OR Launch
      TuleyShop.Lightcatchers, Bash  # somehow I don't think this path is very relevant
      TuleyShop.BlueMoon, Grapple
  pickup GladesTown.BraveMokiHutEX:
    moki: GladesTown.OnwardsAndUpwards, DoubleJump OR Launch
  pickup GladesTown.UpperLeftEX:
    moki:
      Bash, Grenade=1
      Launch
      DoubleJump, Grapple, TuleyShop.StickyGrass OR TuleyShop.BlueMoon
  pickup GladesTown.AboveGromHC:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
      Grapple, TuleyShop.StickyGrass OR TuleyShop.BlueMoon
  pickup GladesTown.MotayHutEX:
    moki: GladesTown.BuildHuts, DoubleJump OR Dash OR Glide
  pickup GladesTown.UpperOre:
    moki: GladesTown.BuildHuts, Bash, Grenade=2, Dash OR Glide

  conn GladesTown.West:
    moki:
      Dash OR Glide
      TuleyShop.BlueMoon, Grapple
  conn GladesTown.TwillenHome: free
  conn GladesTown.Teleporter:
    moki:
      Dash OR Glide
      TuleyShop.Lightcatchers, Bash
      TuleyShop.BlueMoon, Grapple

anchor GladesTown.HoleHut at -214, -4111:  # The ledge below Hole Hut
  pickup GladesTown.BelowHoleHutEX: free
  pickup GladesTown.HoleHutEX:
    moki, GladesTown.RoofsOverHeads:
      TuleyShop.SpringPlants OR DoubleJump OR Dash OR Launch
      Bash, Grenade=1
  pickup GladesTown.HoleHutEC:
    moki, GladesTown.RoofsOverHeads:
      TuleyShop.SpringPlants OR DoubleJump OR Dash OR Launch
      Bash, Grenade=1

  conn GladesTown.ReachPath:
    moki:
      Launch, DoubleJump OR Dash OR Glide  # Can go either to the right wall or through the semisolid branch
      Launch, Grapple, TuleyShop.BlueMoon OR TuleyShop.StickyGrass
      TuleyShop.SpringPlants, Launch
      TuleyShop.BlueMoon, Grapple, DoubleJump OR Dash
      TuleyShop.StickyGrass, Grapple, DoubleJump OR Dash
      TuleyShop.Lightcatchers, TuleyShop.BlueMoon, Bash, Grapple
      TuleyShop.Lightcatchers, TuleyShop.StickyGrass, Bash, Grapple, Glide
  conn TuleyShop:
    moki: InnerWellspring.WaterEscape, Dash OR Glide  # seed paths tbd if ever necessary
  conn GladesTown.Teleporter: free

anchor GladesTown.ReachPath at -140, -4096:  # At the soup
  refill Checkpoint

  # state GladesTown.RatherPlay:  # talking to the Moki that allows to build decoration
  #   moki:  # free if you know the whole branch is semisolid, but you probably don't as a moki player
  #     DoubleJump OR Dash OR Glide OR Launch
  #     TuleyShop.BlueMoon, Grapple

  quest GladesTown.HandToHandSoup:
    moki: InnerWellspring.HandToHandHerbs

  pickup GladesTown.LeafPileEX:
    moki: Flap
  pickup LowerReach.CatalystShard:
    moki:
      Water, Bash, Flap  # seems to be a casual strat the game suggests you to do
      Water, Grenade=1
  pickup GladesTown.UpdraftCeilingEX:
    moki: DoubleJump  # other (non-redundant) paths exist, but this has free retries, otherwise you'd have to go through entire reach to get another attempt

  conn GladesTown.HoleHut:
    moki:  # free if you know the whole branch is semisolid, but you probably don't as a moki player
      DoubleJump OR Dash OR Glide OR Launch
      TuleyShop.BlueMoon, TuleyShop.SpringPlants, Grapple
      TuleyShop.BlueMoon, Grapple, Bash, Grenade=1
  conn GladesTown.Teleporter: free
  conn TuleyShop:
    moki: InnerWellspring.WaterEscape
  conn LowerReach.Trial:
    moki:
      Glide, Bash, Flap OR Grenade=1  # derived from the catalyst path
      Glide, Launch

region WestGlades:
  moki: Danger=20
  unsafe: free

anchor WestGlades.Lower at -545, -4113:  # The right edge of the first pool past glades
  refill Checkpoint
  refill Energy=3:
    moki, Weapon:
      DoubleJump, Dash OR Glide
      Launch

  pickup WestGlades.GrappleEX:
    moki:
      Grapple OR Launch
      Bash, Grenade=1
  pickup WestGlades.AbovePlantEX:
    moki:
      Bash, DoubleJump, Dash OR Glide
      Bash, Dash, Glide
      Water, Bash
      Launch
  pickup WestGlades.LowerPoolEX:
    moki: Water
  pickup WestGlades.SwimEC:
    moki: Water
  pickup WestGlades.LeftOre:
    moki:
      EnemyObstacle, Grapple, DoubleJump, Dash OR Glide
      Grapple, Launch
      Water, Grapple, DoubleJump
      Water, Grapple, WaterDash, Dash OR Glide

  conn WestGlades.Upper:
    moki:
      DoubleJump, Bash, Water OR Dash OR Glide OR Grenade=1
      Launch
  conn GladesTown.West:
    moki:
      Bash, DoubleJump OR Dash OR Glide
      DoubleJump, Dash, Glide
      Launch

anchor WestGlades.Upper at -618, -4054:  # At the waypoint
  refill Checkpoint
  refill Health=1: free

  state LowerReach.BearSneezed:
    moki: Flap

  pickup WestGlades.LeftOre:
    moki: Grapple, DoubleJump OR Dash OR Glide OR Launch
  pickup WestGlades.UpperPoolEX:
    moki: Water
  pickup WestGlades.RightOre:
    moki:
      Bash, DoubleJump OR Dash
      Glide, DoubleJump OR Dash
      DoubleJump, Dash
      Launch

  conn WestGlades.Lower:
    moki:
      EnemyObstacle, DoubleJump OR Dash OR Glide OR Launch
      Water, DoubleJump OR Dash OR Bash OR Glide OR Launch OR Danger=10
  conn LowerReach.Entry:
    moki: LowerReach.BearSneezed
  conn WestGlades.MillApproach:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Bash OR Launch
      Water, WaterDash

anchor WestGlades.MillApproach at -703, -4064:  # At the ledge of the room opening up to Wellspring
  refill Checkpoint
  refill Health=1: free

  pickup WestGlades.ShrineHC:
    moki:
      Grapple, DoubleJump, Dash OR Glide
      DoubleJump, Bash, Grenade=2
      Launch, Bash, Grenade=1
      Launch, DoubleJump OR Grapple
  # any moki path to the ore above way redundant with connection to outerentrance

  conn GladesShrine:
    moki:
      Grapple, Bash, DoubleJump OR Glide
      Bash, Grenade=1, DoubleJump OR Launch
      Launch, DoubleJump OR Grapple
  conn WestGlades.Upper:
    moki:  # realizing the semisolid not considered for moki
      Bash, DoubleJump OR Dash OR Glide OR Grenade=1
      Grapple, DoubleJump OR Dash OR Glide
      DoubleJump, Dash, Glide
      Launch
  conn OuterWellspring.EntranceDoor:
    moki:
      DoubleJump, Grapple
      DoubleJump, Dash OR Glide
      Dash, Glide
      Launch
      Water
  conn PoolsApproach.MillPathCheckpoint:  # this makes more sense here than at OuterWellspring
    moki:
      Danger=15, Water, Grapple, DoubleJump, Dash OR Glide  # you can make this path harder on yourself by not using the wall, but really the fail case is you taking 15 damage
      Water, Grapple, WaterDash OR Launch
      Water, Launch, DoubleJump, Dash
      Water, Launch, Glide

anchor GladesShrine:
  refill Full
  pickup WestGlades.CombatShrine:
    moki, Combat, Bash:  # the shooter plants have basically no attack surface without bash
      Danger=65                     # the crabs are terrifying!
      Danger=55, DoubleJump OR Dash # these can help
      Danger=30, Launch             # if you're op, nothing's terrifying

region OuterWellspring:
  moki: Danger=25
  unsafe: free

anchor OuterWellspring.EntranceDoor at -856, -4058:  # Outside the door where you enter the first room
  refill Checkpoint
  refill Health=1:
    unsafe: free  # barely out of sight, also past an enemy...
  refill Energy=3:
    unsafe: Weapon  # pretty far to the left

  # ommited a lot of paths in moki including most bash-related paths because of how complex this place is to navigate (as in, more paths were omitted than were taken into moki...)
  state OuterWellspring.EntranceDoorOpen:
    moki, BreakWall=16:
      DoubleJump, Dash OR Glide
      Dash, Glide
      Grapple, Glide
      Bash, DoubleJump OR Dash OR Glide  # use the insect
      Launch

  pickup OuterWellspring.EntranceRoofEX:
    moki:
      DoubleJump, Grapple, Dash OR Glide
      Grapple, Launch
  pickup OuterWellspring.WheelEX:
    moki: OuterWellspring.EntranceDoorOpen
  pickup OuterWellspring.BasementEC:
    moki:
      Water, DoubleJump, Dash OR Glide
      Water, Dash, Glide
      Water, Grapple, Bash, DoubleJump OR Dash
      Water, Grapple, Glide
      Water, Bash, Grenade=1, DoubleJump OR Dash OR Glide
      Water, Launch
      OuterWellspring.EntranceDoorOpen  # casual strat I guess?
    unsafe:
      Glide, Dash, Bash, Damage=20  # in unsafe due to a single tick of poison water damage needed
      DoubleJump, Bash, Damage=20  # also only one tick of water damage! 
  pickup OuterWellspring.LifeHarvestShard:
    moki, BreakWall=20:
      DoubleJump, Bash
      Launch
    unsafe, BreakWall=20:
      # SentryJump
      Bash, Grenade=1  # this would be in moki if the camera didn’t put ori right at the top of the screen, making it hard to aim/catch the grenade
  pickup OuterWellspring.SwimEX:
    moki: Water
  pickup OuterWellspring.SwimOre:
    moki: 
      Water, Grapple OR WaterDash OR Launch
    gorlek:
      Water, Bash, Grenade=1          # stand on the spinny wheel and bash-grenade up
      Water, SentryJump=1             # ooooor use a SentryJump
      Water, DoubleJump, TripleJump   # ooooor just some regular jumps!

  conn InnerWellspring.EntranceDoor:
    moki: OuterWellspring.EntranceDoorOpen
  conn OuterWellspring.AboveEntranceDoor:
    moki: DoubleJump, Grapple  # save all the other ways for gorlek...
  # connections using the left wall wheel would be pointless
  conn WestGlades.MillApproach:
    moki:
      DoubleJump, Dash
      Bash, Grenade=2, DoubleJump OR Dash OR Glide
      Launch
      Water

anchor OuterWellspring.AboveEntranceDoor at -837, -4026:  # at the crystal above the entrance door
  refill Energy=3:
    moki: Weapon

  state OuterWellspring.WestDoorBlueMoonFree:
    moki, RangedWeapon:
      Grapple, DoubleJump, Dash
      Grapple, Glide OR Launch

  pickup OuterWellspring.RightWallOre:
    moki: Grapple

  conn OuterWellspring.EastDoor:  # going to the right
    moki:
      Grapple, DoubleJump, Dash OR Glide
      Launch
  conn OuterWellspring.WestDoor:  # going to the left
    moki:
      Grapple, DoubleJump, Dash
      Grapple, Glide OR Launch

anchor OuterWellspring.WestDoor at -892, -3992:  # Outside the door where you exit the first room
  refill Checkpoint

  # the wheel is only a shortcut, at least in moki doesn't open up anything new
  state OuterWellspring.WestDoorBlueMoonFree:
    moki: BreakWall=3, Launch

  pickup OuterWellspring.HiddenHC:
    moki, OuterWellspring.WestDoorBlueMoonFree:
      Grapple, DoubleJump, Dash OR Glide
      Grapple, Dash, Glide
      Grapple, Launch
  pickup OuterWellspring.EntranceRoofEX:
    moki: DoubleJump, Launch, Dash OR Glide

  conn InnerWellspring.WestDoor:
    moki: InnerWellspring.MiddleDoorsOpen
  conn OuterWellspring.EastDoor:
    moki:
      Grapple, DoubleJump, Dash OR Glide
      Launch, DoubleJump OR Dash OR Glide
      Launch, Grapple
  conn OuterWellspring.EntranceDoor: free

anchor OuterWellspring.EastDoor at -814, -3973:  # Outside the door leading to the spin puzzle
  refill Checkpoint

  state OuterWellspring.WestDoorBlueMoonFree:
    moki, RangedWeapon:
      DoubleJump OR Dash OR Glide
      Bash, Grenade=1
      InnerWellspring.TopDoorOpen, Grapple

  quest OuterWellspring.TheLostCompass:
    moki: InnerWellspring.NeedleQI

  pickup OuterWellspring.RightWallOre:
    moki: DoubleJump OR Dash OR Glide OR Grapple OR Launch
  pickup OuterWellspring.RightWallEC:
    moki, BreakWall=20:
      DoubleJump, Dash
      Glide OR Launch
      Grapple, DoubleJump OR Dash
  pickup OuterWellspring.RightWallEX:
    moki:
      DoubleJump, Grapple, Dash OR Glide
      DoubleJump, Bash, Grenade=1, Grapple
      Launch

  conn InnerWellspring.EastDoor:
    moki: InnerWellspring.MiddleDoorsOpen
  conn OuterWellspring.AboveWestDoor:
    moki:
      Grapple, InnerWellspring.TopDoorOpen OR EnemyObstacle
      Launch
  conn OuterWellspring.WestDoor:
    moki:
      DoubleJump OR Dash OR Launch
      InnerWellspring.TopDoorOpen, OuterWellspring.WestDoorBlueMoonFree, Grapple
  conn OuterWellspring.TrialRoom:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Launch
  conn OuterWellspring.EntranceDoor: free
  conn WestGlades.MillApproach:
    moki: Grapple OR Glide OR Launch

anchor OuterWellspring.AboveWestDoor at -866, -3949:  # on the platform arcing over west door
  refill Energy=3:
    moki: Weapon

  pickup OuterWellspring.HiddenHC:
    moki, EnemyObstacle:
      Grapple, DoubleJump, Dash OR Glide
      Grapple, Dash, Glide
      Launch, DoubleJump OR Dash OR Grapple OR Glide

  conn OuterWellspring.TopDoor:
    moki:
      InnerWellspring.TopDoorOpen, Grapple OR Launch
      Bash, Grenade=1
      Launch
  conn OuterWellspring.WestDoor:
    moki: DoubleJump OR Dash OR Grapple OR Glide OR Launch
  conn InnerWellspring.EastDoor:
    moki:
      DoubleJump, Dash
      Glide OR Grapple OR Launch
  conn OuterWellspring.EntranceDoor: free

anchor OuterWellspring.TopDoor at -836, -3927:  # Outside the door leading to the teleporter
  # state OuterWellspring.TrialActivation:
  #   moki:
  #     EnemyObstacle, DoubleJump, Grapple, Dash OR Glide
  #     DoubleJump, Grapple, Bash, Grenade=1
  #     Bash, Grenade=2
  #     Launch

  pickup OuterWellspring.UltraGrappleShard:
    moki:
      EnemyObstacle, DoubleJump, Grapple, Dash OR Glide
      Bash, Grenade=1
      Launch

  conn InnerWellspring.Teleporter:
    moki: InnerWellspring.TopDoorOpen
  conn OuterWellspring.EastDoor: free
  conn OuterWellspring.AboveWestDoor: free

anchor OuterWellspring.TrialRoom at -684, -3947:  # checkpoint on the way to trial start
  refill Checkpoint
  refill Health=1: free
  refill Energy=1:
    moki: Weapon

  pickup OuterWellspring.TrialOre:
    moki:
      Grapple, DoubleJump
      Launch
  pickup OuterWellspring.RightWallOre:
    moki: DoubleJump OR Dash OR Glide OR Grapple OR Launch
  pickup OuterWellspring.RightWallEC:
    moki, BreakWall=20:
      DoubleJump, Dash
      Glide OR Launch
      Grapple, DoubleJump OR Dash
  # connection should cover the spirit light in moki

  conn OuterWellspring.EastDoor:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Launch
  conn OuterWellspring.EntranceDoor:
    moki: DoubleJump OR Dash OR Glide OR Grapple OR Launch
  conn WestGlades.MillApproach:
    moki: Grapple OR Glide OR Launch

region InnerWellspring:
  moki: Danger=25
  unsafe: free

anchor InnerWellspring.EntranceDoor at -1263, -3952:  # Inside the door where you enter the first room
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  state InnerWellspring.ShortCutWheel:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Launch

  pickup InnerWellspring.ThornShard:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      DoubleJump, Bash, Grenade=1
      Launch
      BreakWall=3, DoubleJump OR Dash OR Glide  # break the three wheels free
  pickup InnerWellspring.ThornEX:
    moki:
      Grapple, DoubleJump, Dash OR Glide
      Launch
  pickup InnerWellspring.ThreeWheelsEX:
    moki:
      Bash, Grenade=1
      Launch
      BreakWall=3  # break the three wheels free
  pickup InnerWellspring.WaterSwitchEX:
    moki: Water, WaterDash

  conn OuterWellspring.EntranceDoor: free
  conn InnerWellspring.DrainRoom:
    moki:
      DoubleJump OR Dash OR Glide OR Launch
      BreakWall=3, Grapple  # break the three wheels free
      BreakWall=3, Bash, Grenade=1  # break the three wheels free
  conn InnerWellspring.WestDoor:
    moki:  # this in combination with the ShortCutWheel state accounts for all paths to the EX in the wheel
      Grapple, DoubleJump, Dash OR Glide
      Grapple, Dash, Glide
      Launch

anchor InnerWellspring.DrainRoom at -1167, -3946:  # Left of the water you can drain
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  pickup InnerWellspring.DrainHC:
    moki, InnerWellspring.DrainLever:
      DoubleJump OR Grapple OR Launch  # bit of a weird pickup
      Water, Dash OR Glide
  pickup InnerWellspring.DrainEX:
    moki, InnerWellspring.DrainLever:  # the skeetos just want to be bashed here
      DoubleJump, Water OR Bash
      Dash, Bash, Grenade=1
      Water, Bash, Grenade=1, Grapple OR Glide
      Launch
    # ShurikenBreak note: this wall has 10 health
  pickup InnerWellspring.LaserOre:
    moki:
      RangedWeapon, BreakWall=16, DoubleJump, Dash OR Glide  # don't see a better solution... refill nearby should mitigate the overestimated energy requirement
      EnemyObstacle, Grapple, DoubleJump, Dash
      EnemyObstacle, Grapple, Glide
      Launch

  conn InnerWellspring.EntranceDoor:
    moki:
      DoubleJump OR Dash OR Grapple OR Glide OR Launch
      Bash, Grenade=1
  conn InnerWellspring.BelowDrainLever:
    moki:
      RangedWeapon, BreakWall=16, DoubleJump, Dash OR Glide  # don't see a better solution... refill nearby should mitigate the overestimated energy requirement
      BreakWall=16, Grapple, DoubleJump OR Dash OR Glide
      Grapple, DoubleJump, Dash OR Glide
      Launch

anchor InnerWellspring.BelowDrainLever at -1153, -3895:  # In the first room below the drain lever
  refill Checkpoint

  state InnerWellspring.UpperCorruption:  # the fourth corruption you see on your way
    moki, BreakWall=16:
      DoubleJump, Dash OR Glide
      Launch
  state InnerWellspring.DrainLever:
    moki:
      Bash, Grenade=1  # not softlockable: UpperCorruption solves this
      InnerWellspring.UpperCorruption OR Launch

  pickup InnerWellspring.LaserOre:
    moki, EnemyObstacle:
      DoubleJump, Dash
      Glide OR Launch
  pickup InnerWellspring.LeverEC:
    moki:
      Bash, Grenade=2  # not softlockable: UpperCorruption solves this
      Bash, Grenade=1, Grapple, DoubleJump OR Dash OR Glide  # not softlockable: UpperCorruption solves this
      Launch
      InnerWellspring.UpperCorruption, Bash, Grenade=1
      InnerWellspring.UpperCorruption, Grapple, DoubleJump OR Dash OR Glide
  pickup InnerWellspring.LupoEX:
    moki:
      DoubleJump, Dash OR Glide
      Launch

  conn InnerWellspring.WestDoor:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
      InnerWellspring.UpperCorruption
  conn InnerWellspring.DrainRoom:
    moki:
      DoubleJump, Dash
      Grapple OR Glide OR Launch

anchor InnerWellspring.WestDoor at -1216, -3897:  # Inside the door where you exit the first room
  refill Checkpoint
  refill Health=2: free
  refill Energy=3:
    moki: Weapon

  state InnerWellspring.MiddleDoorsOpen:
    moki:
      Grapple
      Bash, Grenade=1, Launch

  pickup InnerWellspring.ShortcutWheelEX:
    moki: InnerWellspring.ShortCutWheel
  pickup InnerWellspring.LupoMap:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Bash  # bash the skeeto
      InnerWellspring.UpperCorruption
  pickup InnerWellspring.GrappleTreeEX:
    moki:
      DoubleJump, Grapple
      Bash, Grenade=2
      Bash, Grenade=1, DoubleJump OR Dash OR Glide OR Grapple
      Launch
  pickup InnerWellspring.GrappleTree:
    moki:
      DoubleJump OR Dash OR Glide OR Grapple OR Launch
      Bash, Grenade=1  # the jumper would be kind of lure-ish

  conn OuterWellspring.WestDoor:
    moki: InnerWellspring.MiddleDoorsOpen
  conn InnerWellspring.BelowDrainLever: free

anchor InnerWellspring.EastDoor at -1190, -3733:  # Inside the door leading to the spin puzzle
  refill Checkpoint
  refill Health=1: free
  refill Energy=4:
    moki: Weapon

  state InnerWellspring.SpinArena:  # finishing the arena and destroying the corruption that open the door to spin puzzle
    moki: Combat, DoubleJump OR Dash OR Glide OR Launch  # +25 region danger
  state InnerWellspring.SpinPuzzleSolved:  # to prevent softlocks the pickups in the spin puzzle room unlock only after completing it
    moki, InnerWellspring.SpinArena:
      Grapple, DoubleJump OR Dash
      Grapple, Bash, Grenade=1
      Launch
    unsafe:
      Water, DoubleJump, Dash OR Glide
  state InnerWellspring.TopDoorOpen:
    moki, InnerWellspring.SpinArena, InnerWellspring.SpinPuzzleSolved, EnemyObstacle, BreakWall=16:
      Grapple, DoubleJump, Dash OR Glide
      Grapple, Dash, Glide
      Grapple, Launch

  quest InnerWellspring.HandToHandHerbs:
    moki: GladesTown.HandToHandPouch
  quest InnerWellspring.NeedleQI:
    moki, InnerWellspring.TopDoorOpen:
      InnerWellspring.SpinArena, InnerWellspring.SpinPuzzleSolved, Grapple, Dash, Glide
      Grapple, DoubleJump OR Launch
      DoubleJump, Bash, Grenade=1
      Launch, DoubleJump

  pickup InnerWellspring.AboveSpinArenaEX:
    moki:
      Grapple, DoubleJump OR Dash
      Launch
  pickup InnerWellspring.RotateRoomEX:
    moki: InnerWellspring.SpinArena, InnerWellspring.SpinPuzzleSolved
  pickup InnerWellspring.RotateRoomOre:
    moki: InnerWellspring.SpinArena, InnerWellspring.SpinPuzzleSolved

  conn OuterWellspring.EastDoor:
    moki: InnerWellspring.MiddleDoorsOpen

anchor InnerWellspring.Teleporter at -1308, -3675:  # At the teleporter
  refill Full

  quest InnerWellspring.BlueMoonSeed:
    moki:
      DoubleJump, Dash
      Bash, Grenade=1
      Launch

  pickup InnerWellspring.LibraryEX: free
  pickup InnerWellspring.AboveTpEX:
    moki:
      DoubleJump, Dash OR Glide
      Bash, Grenade=1
      Launch
  pickup InnerWellspring.SwimOre:
    moki: Water

  conn Teleporters: free
  conn InnerWellspring.EscapeSequence:
    moki:
      DoubleJump, Dash, Grapple
      Bash, Grenade=1, Grapple
      Bash, Grenade=1, DoubleJump, Dash
      Bash, Grenade=2
      Launch
  conn OuterWellspring.TopDoor: free
  conn OpherShop: free

anchor InnerWellspring.EscapeSequence:
  refill Full
  quest InnerWellspring.WaterEscape:
    moki:
      Bash, Grapple, DoubleJump, Dash OR Glide
      Bash, Grapple, Dash, Glide
      Grapple, Launch
  pickup InnerWellspring.EscapeRevisitEX:
    moki: InnerWellspring.WaterEscape

region WoodsEntry:
  moki: Danger=40, Regenerate
  unsafe: free

anchor WoodsEntry.ShriekMeet at 478, -4205:  # The ledge to the left of where the mudpits start
  refill Checkpoint

  pickup WoodsEntry.MudPitEX:
    moki:
      DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=2

  conn WoodsEntry.BelowTeleporter:
    moki, RangedWeapon:
      Danger=10, DoubleJump OR Dash OR Glide OR Launch
      Bash, DoubleJump OR Dash OR Glide OR Launch
  conn EastHollow.Kwolok:
    unsafe: Water, Bash

anchor WoodsEntry.BelowTeleporter at 591, -4198:  # Read the name
  refill Checkpoint

  conn WoodsEntry.ShriekMeet:
    moki, RangedWeapon:
      DoubleJump, Dash OR Glide
      Launch
  conn WoodsEntry.Teleporter:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Bash, Grenade=1, DoubleJump OR Dash OR Glide
      Launch
  conn WoodsEntry.TwoKeystoneRoom:
    moki: RangedWeapon, DoubleJump OR Dash OR Glide OR Launch

anchor WoodsEntry.Teleporter at 611, -4162:  # At the West Woods Teleporter
  refill Full

  quest WoodsEntry.LastTreeBranch: free
  quest WoodsEntry.DollQI:
    moki: GladesTown.FamilyReunionKey
  quest WoodsEntry.TreeSeed:
    moki: TuleyShop.LastTreeBranchRejected

  pickup WoodsEntry.TpEX: free
  pickup WoodsEntry.LeafPileEX:
    moki: Flap
  pickup WoodsEntry.LedgeOre:
    moki:
      Glide, DoubleJump OR Launch
      Bash, Grenade=1, Glide OR Launch
      DoubleJump, Dash, Launch  # coming from below you'd just need Launch
#    unsafe:
#      Glide, SentryJump=1

  conn Teleporters: free
  conn WoodsEntry.ShriekMeet: free
  conn WoodsEntry.BelowTeleporter: free

anchor WoodsEntry.TwoKeystoneRoom at 672, -4183:  # In front of the keystone door
  refill Checkpoint
  refill Energy=3:
    moki: WoodsEntry.KeystoneDoor, Weapon

  state WoodsEntry.KeystoneDoor:
    moki: Keystone=2

  pickup WoodsEntry.LowerKS:
    moki: DoubleJump OR Dash OR Glide  # Launch is awful
  pickup WoodsEntry.UpperKS:
    moki: DoubleJump OR Launch
#   unsafe:
#     SentryJump=1, Glide

  conn WoodsMain.BelowFourKeystoneRoom:
    moki, WoodsEntry.KeystoneDoor, EnemyObstacle:
      DoubleJump, Dash
      Bash OR Glide OR Launch  # bash uses the enemy
  conn WoodsEntry.BelowTeleporter:
    moki: RangedWeapon, DoubleJump OR Glide OR Launch

region WoodsMain:
  moki: Danger=40, Regenerate
  unsafe: free

anchor WoodsMain.BelowFourKeystoneRoom at 951, -4210:  # At the first leaf pile after meeting Ku
  state WoodsEntry.KeystoneDoor:
    moki, Keystone=2:
      Bash, Grenade=2, Danger=10  # uses the enemy
      Bash, Grenade=1, Danger=10, DoubleJump OR Dash  # uses the enemy
      Launch, DoubleJump OR Dash OR Bash OR Glide  # bash uses the enemy

  pickup WoodsMain.LowerLeafPileEX:
    moki: Flap
  pickup WoodsMain.BehindWallOre:
    moki: BreakWall=20, RangedWeapon, Bash, Grenade=2, DoubleJump  # different ways to solve
    unsafe: BreakWall=20, DoubleJump, Dash  # Perform wrap-around double jumps on the far right wall under the ore
  pickup WoodsMain.BelowKeystonesEX:
    moki: RangedWeapon, Bash, Grenade=2, DoubleJump  # different ways to solve

  conn WoodsMain.FourKeystoneRoom:
    moki, RangedWeapon:
      Flap, Glide
      Bash, Grenade=2, DoubleJump, Dash  # different ways to solve
      Launch
  conn WoodsEntry.TwoKeystoneRoom:
    moki, WoodsEntry.KeystoneDoor:
      Bash, Grenade=2, Danger=10  # uses the enemy
      Bash, Grenade=1, Danger=10, DoubleJump OR Dash  # uses the enemy
      Launch, DoubleJump OR Dash OR Bash OR Glide  # bash uses the enemy

anchor WoodsMain.FourKeystoneRoom at 950, -4168:  # The floor of the keystone room
  pickup WoodsMain.BehindWallOre:
    moki: BreakWall=20, DoubleJump OR Dash OR Glide OR Launch
  pickup WoodsMain.BelowKeystonesEX:
    moki: Bash, DoubleJump OR Dash OR Glide OR Launch
  pickup WoodsMain.MiddleLeafPileEX:
    moki: Flap
  pickup WoodsMain.RightKS:
    moki:
      Glide OR Launch
      Bash, Grenade=1

  conn WoodsMain.BeforeKeystoneDoor:
    moki:
      DoubleJump OR Glide OR Launch
      Bash, Dash OR Grenade=1
  conn WoodsMain.BelowFourKeystoneRoom: free

anchor WoodsMain.BeforeKeystoneDoor at 944, -4137:  # In front of the four keystone door
  refill Checkpoint

  state WoodsMain.KeystoneDoor:
    moki: Keystone=4

  pickup WoodsMain.UpperKS:
    moki, BreakWall=3:
      Glide OR Launch
      Bash, Grenade=1, DoubleJump OR Dash
  pickup WoodsMain.LeftKS:
    moki: Glide
  pickup WoodsMain.LowerKS:
    moki, Flap:  # Flap being the casual way of breaking the yellow barrier
      Glide OR Launch
      DoubleJump, Dash
      Bash, DoubleJump OR Dash

  conn WoodsMain.GiantSkull:
    moki: WoodsMain.KeystoneDoor
  conn WoodsMain.FourKeystoneRoom: free

anchor WoodsMain.GiantSkull at 957, -4138:  # Behind the four keystone room door
  refill Checkpoint

  state WoodsMain.KeystoneDoor:
    moki: Keystone=4
  state WoodsMain.BelowHiddenOreCorruption:  # defined as state because some paths cross this twice
    moki:
      BreakWall=3, Glide
      RangedWeapon, Launch

  pickup WoodsMain.UpperLeafPileEX:
    moki: Flap
  pickup WoodsMain.BehindDoorRoofEX:
    moki:
      Bash OR Launch
      DoubleJump, Dash, Glide

  conn WoodsMain.BelowHiddenOre:
    moki: WoodsMain.BelowHiddenOreCorruption, Glide OR Launch
  conn WoodsMain.BeforeKeystoneDoor:
    moki: WoodsMain.KeystoneDoor

anchor WoodsMain.BelowHiddenOre at 1038, -4101:  # Below and to the right of the hidden ore, close to the yellow wall
  state WoodsMain.BelowHiddenOreCorruption:  # defined as state because some paths cross this twice
    moki: BreakWall=3

  pickup WoodsMain.HiddenOre:
    moki: Flap, Glide
  pickup WoodsMain.YellowWallEX:
    moki: WoodsMain.BelowHiddenOreCorruption, Flap, Glide OR Launch

  conn WoodsMain.PetrifiedHowl:
    moki: Glide
  conn WoodsMain.GiantSkull:
    moki, WoodsMain.BelowHiddenOreCorruption:
      Glide OR Launch
      DoubleJump, Dash

anchor WoodsMain.PetrifiedHowl at 910, -4071:  # At silenced Howl
  refill Health=1: free

  pickup WoodsMain.PetrifiedHowlEX: free

  conn WoodsMain.AboveHowl:
    moki:
      BreakWall=3, Bash, Glide, DoubleJump OR Grenade=2
      BreakWall=3, DoubleJump, Dash, Glide
      Launch, DoubleJump OR Dash OR Glide OR Bash  # a bit awful honestly. The good news is that you can also just Launch upwards easily instead of going the long way
  conn WoodsMain.BelowHiddenOre:
    moki:
      Glide
      Launch, DoubleJump OR Dash

anchor WoodsMain.AboveHowl at 916, -4047:  # At the semisolid above silenced Howl
  # state WoodsMain.TrialActivation:
  #   moki:
  #     DoubleJump, Dash, Bash, Grapple, Glide, Burrow
  #     Launch, Grapple, Bash, DoubleJump OR Dash OR Glide

  pickup WoodsMain.HiddenEX: free
  pickup WoodsMain.OverflowShard:
    moki:
      DoubleJump, Bash, Grapple, Burrow, Dash OR Glide
      Launch, Grapple, Bash, DoubleJump OR Dash OR Glide

  conn WoodsMain.Teleporter:
    moki, RangedWeapon:
      DoubleJump OR Launch
      Bash, Grenade=1
  conn WoodsMain.PetrifiedHowl: free

anchor WoodsMain.Teleporter at 1083, -4052:  # At the East Woods Teleporter
  refill Full

  conn Teleporters: free
  conn WoodsMain.AbovePit:
    moki:
      Glide
      DoubleJump, Bash, Launch  # :)
  conn WoodsMain.AboveHowl:
    moki:
      Glide, Launch
      DoubleJump, Glide, Bash, Grenade=1
      DoubleJump, Bash, Launch  # :)

anchor WoodsMain.AbovePit at 1234, -3985:  # To the left of the pit before feeding grounds
  refill Energy=3:  # the crystal in the pit
    unsafe: Weapon, Bash, DoubleJump OR Dash OR Glide OR Launch  # technically just Bash

  # connections to the east woods teleporter would be a dead end in moki
  conn WoodsMain.AboveHowl:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
  conn WoodsMain.FeedingGrounds:
    moki:  # these cover the shrine connections as well
      DoubleJump, Dash OR Bash
      Glide OR Launch
      Bash, Grenade=1

anchor WoodsMain.FeedingGrounds at 1292, -3993:  # At the left entrance to feeding grounds
  refill Checkpoint
  refill Energy=3:

  # having the initial escape completed is a negative, not a positive. The paths going through it are the connections to Wastes.
  # if you complete the initial escape, rocks fall and block most of the connection paths to WestTP. This is equally true for the base game though and solved by the fact that if you complete the escape, you unlock the teleporter, making these paths not softlockable
  pickup WoodsMain.ShrineEX:
    moki:
      Glide OR Launch
      DoubleJump, Dash

  conn WoodsShrine:
    moki:
      Glide OR Launch
      DoubleJump, Dash
  conn LowerWastes.WestTP:
    moki:
      Grapple, Glide, DoubleJump OR Dash OR Launch  # this solves with Seir as well
      WindtornRuins.Seir:  # these wouldn't solve without Seir
        DoubleJump, Bash, Grenade=1, Grapple
        Grapple, Glide
        Burrow
        Launch
  conn WoodsMain.AbovePit:
    moki:
      DoubleJump, Bash
      Launch

anchor WoodsShrine:
  refill Full
  pickup WoodsMain.CombatShrine:
    moki, Combat, RangedWeapon, Bash, Hammer OR Launch:  # this one has it all -_-
      Danger=80
      Danger=65, DoubleJump OR Dash
      Danger=50, Launch

region LowerReach:
  moki: Danger=40, Regenerate
  unsafe: free

anchor LowerReach.Entry at -390, -4025:  # Behind Baur
  refill Checkpoint
  refill Health=1: free

  state LowerReach.BearSneezed:
    moki: Flap
  state LowerReach.HeatBaurFurnace:
    moki, LowerReach.BearSneezed, LowerReach.BearBridgeBroken:
      Bash, Flap
      Grenade=1
  state LowerReach.CoolBaurFurnace:
    moki: LowerReach.BearSneezed, LowerReach.BearBridgeBroken, Flap

  pickup LowerReach.BelowBaurEX:
    moki, LowerReach.BearSneezed, LowerReach.BearBridgeBroken:
      DoubleJump, Dash, Bash, Flap
      Bash, Grenade=1
      Launch

  conn LowerReach.AboveEntry:
    moki:
      DoubleJump, Launch  # Can't rely on the sleeping bear to be there
      Bash, DoubleJump OR Launch
      Bash, Grenade=1
    unsafe:
      Launch
  conn WestGlades.Upper:
    moki: LowerReach.BearSneezed

anchor LowerReach.AboveEntry at -401, -4000:  # On the platform above Baur inside the tree trunk
  refill Checkpoint

  state LowerReach.Lever:
    moki:
      Launch
      LowerReach.HeatBaurFurnace, DoubleJump

  pickup LowerReach.AboveBaurLowerEX:
    moki:
      Launch
      LowerReach.HeatBaurFurnace OR Grenade=1:  # these use a grenadebash if they can't use the unfrozen tongue plant
        DoubleJump, Bash
        Dash, Bash, Glide
      LowerReach.CoolBaurFurnace, Bash, Grenade=1  # seemed a bit hectic without cooling the furnace
  pickup LowerReach.AboveBaurUpperEX:
    moki:
      Launch
      LowerReach.HeatBaurFurnace, DoubleJump, Dash, Bash

  conn LowerReach.Entry: free
  conn LowerReach.Icefall:
    moki:
      DoubleJump OR Launch
      LowerReach.HeatBaurFurnace
      # could use bashgrenades to get past the frozen tongue plant, but seems a bit unintuitive
  conn LowerReach.Central:
    moki, LowerReach.Lever:
      Bash, DoubleJump OR Dash OR Glide
      Launch

anchor LowerReach.Icefall at -448, -3999:  # Where you drop the rock on Baur's nose
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  state LowerReach.BearBridgeBroken:
    moki, LowerReach.BearSneezed  # the game behaves weird when dropping the rock on Baur, so not making that moki
  state LowerReach.LeftFurnace:
    moki:
      Grenade=1, Bash, DoubleJump OR Dash OR Glide  # Grenade to light the furnace
      Grenade=1, Launch  # Grenade to light the furnace

  pickup LowerReach.IcefallOre:
    moki, LowerReach.LeftFurnace, EnemyObstacle:
      Bash, Grapple OR Launch  # bash the enemies
      Grapple, Danger=10, DoubleJump OR Dash  # grapple past the enemies and probably get hit by them
      Water, Launch  # swim past the enemies
  pickup LowerReach.IcefallEX:
    moki, LowerReach.LeftFurnace, EnemyObstacle:
      DoubleJump, Bash  # bash the enemies
      DoubleJump, Grapple, Danger=10  # grapple past the enemies and probably get hit by them
      Water, DoubleJump, WaterDash  # swim past the enemies
      Launch

  conn LowerReach.Entry: free
  conn LowerReach.AboveEntry:
    moki:
      DoubleJump OR Launch
      LowerReach.HeatBaurFurnace

anchor LowerReach.Central at -335, -4010:  # After the lever door
  refill Checkpoint

  pickup LowerReach.AboveDoorEX:
    moki:
      LowerReach.CentralFurnace:
        DoubleJump, Dash, Bash OR Hammer OR Spear=1
        Bash, Grenade=1
      Launch
  pickup LowerReach.LupoMap:
    moki:
      Launch
      DoubleJump, Dash
      LowerReach.CentralFurnace, Bash, Grenade=1, DoubleJump OR Dash OR Glide
  pickup LowerReach.TPLeftEX:
    moki:
      Launch
      LowerReach.CentralFurnace:
        DoubleJump, Dash
        Bash, Grenade=1, DoubleJump OR Dash OR Glide

  conn LowerReach.SecondSoup: free
  conn LowerReach.OutsideTPRoom:
    moki:
      Launch
      LowerReach.CentralFurnace:
        DoubleJump, Dash, Bash
        Bash, Grenade=1

anchor LowerReach.OutsideTPRoom at -311, -3970:  # To the left of the teleporter room
  refill Checkpoint
  refill Full:  # use the teleporter
    moki: Grenade=1
  refill Health=1: free
  refill Energy=3:
    moki: Weapon

  pickup LowerReach.AboveDoorEX:
    moki: Bash OR Hammer OR Spear=1
  pickup LowerReach.LupoMap:
    moki: DoubleJump OR Dash OR Glide OR Launch
  pickup LowerReach.TPLeftEX:
    moki:
      Bash, DoubleJump OR Dash OR Glide
      Launch
  pickup LowerReach.HiddenOre:
    moki:
      Launch
      LowerReach.CentralFurnace, DoubleJump, Bash, Dash OR Glide OR Grenade=1

  conn LowerReach.SecondSoup: free
  conn LowerReach.Central:
    moki: DoubleJump OR Dash OR Bash OR Glide OR Launch OR Hammer OR Spear=1
  conn UpperReach.KeystoneRoom:
    moki:
      DoubleJump, Dash, Bash  # bash the squonkey
      DoubleJump, Bash, Grenade=2  # bash the squonkey
      Launch
  conn LowerReach.Teleporter:
    moki: Grenade=1

anchor LowerReach.Teleporter at -259, -3962:  # This has to exist to support the teleporter pickup
  refill Full

  conn Teleporters: free
  conn LowerReach.OutsideTPRoom:
    moki: Grenade=1

region UpperReach:
  moki: Danger=40, Regenerate
  unsafe: free

anchor UpperReach.KeystoneRoom at -298, -3919:  # At Tokk
  refill Checkpoint
  # the crystal is evil

  state UpperReach.HeatFurnace:
    moki:
      Grenade=1  # this makes grenadebash paths meaningless
      Flap, Bash, DoubleJump OR Launch
  state UpperReach.CoolFurnace:  # need this because the player might have to refreeze the waterfall
    moki: Flap

  pickup UpperReach.LifeForceShard:
    moki:
      Bash, Grenade=1, Burrow, DoubleJump, Dash  # Just one of djump / dash is maybe too precise for moki
      Bash, Grenade=1, Burrow, Glide
      Burrow, Launch
  pickup UpperReach.LifeForceEX:
    moki:
      Bash, Grenade=1, Burrow, DoubleJump, Dash
      Bash, Grenade=1, Burrow, Glide
      Burrow, Launch
  pickup UpperReach.LowerKS:
    moki:
      Launch
      UpperReach.HeatFurnace:
        DoubleJump
        Bash, Grenade=1
  pickup UpperReach.MiddleLeftKS:
    moki:
      Launch, DoubleJump OR Dash OR Glide
      UpperReach.HeatFurnace:
        DoubleJump, Bash, Grapple OR Glide
        Dash, Bash, Grenade=1, Glide
  pickup UpperReach.UpperKS:
    moki:
      DoubleJump, Bash, Grenade=1  # go past the hidden ore
      Launch
      UpperReach.CoolFurnace, DoubleJump, Bash  # use the icefall
      UpperReach.HeatFurnace:
        DoubleJump, Bash, Grapple  # grenadebash at the waterfall would be redundant with the path going past the hidden ore that doesn't rely on furnace state
        DoubleJump, Bash, Glide  # using the tongue plant
  pickup UpperReach.MiddleRightKS:
    moki, UpperReach.HeatFurnace:
      Bash, Glide, DoubleJump OR Grenade=1  # use the tongue plant
      DoubleJump, Bash, Grenade=1  # go past the hidden ore
      DoubleJump, Grapple
      Bash, Grenade=2, Dash  # bashgrenade at the waterfall
      Water, Bash, Grenade=1, Dash  # also bashgrenade at waterfall
      Water, Bash, Grenade=2  # still bashgrenade at waterfall
      Launch
  pickup UpperReach.SoupOre:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
      UpperReach.CoolFurnace:
        DoubleJump
        Bash, Grenade=1
      UpperReach.HeatFurnace:
        Bash, Glide, DoubleJump OR Grenade=1  # use the tongue plant
        DoubleJump, Grapple
        Bash, Grenade=2, Dash  # bashgrenade at the waterfall
        Water, Bash, Grenade=1, Dash  # also bashgrenade at waterfall
        Water, Bash, Grenade=2  # still bashgrenade at waterfall
  pickup UpperReach.SwingPoleEX:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
      UpperReach.CoolFurnace:
        DoubleJump
        Bash, Grenade=1
      UpperReach.HeatFurnace:
        Bash, Glide, DoubleJump OR Grenade=1  # use the tongue plant
        DoubleJump, Grapple
        Bash, Grenade=2, Dash  # bashgrenade at the waterfall
        Water, Bash, Grenade=1, Dash  # also bashgrenade at waterfall
        Water, Bash, Grenade=2  # still bashgrenade at waterfall
  pickup UpperReach.SwimEX:
    moki: UpperReach.HeatFurnace, Water, EnemyObstacle OR DoubleJump

  conn UpperReach.OutsideTreeRoom:
    moki, UpperReach.HeatFurnace, EnemyObstacle:
      DoubleJump, Dash OR Grapple
      Bash, Grenade=1, DoubleJump OR Dash OR Glide OR Grapple
      Launch
      Water
  conn LowerReach.OutsideTPRoom: free

anchor UpperReach.OutsideTreeRoom at -169, -3911:  # In front of the keystone door
  refill Checkpoint
  refill Energy=3:
    moki, UpperReach.HeatFurnace, Weapon:
      Water, Grapple, DoubleJump OR Dash OR Glide
      Launch

  state UpperReach.KeystoneDoor:
    moki: Keystone=4

  pickup UpperReach.TreeOre:
    moki:
      DoubleJump, Bash, Grenade=1, Dash OR Glide
      Dash, Bash, Grenade=1, Glide
      Launch, DoubleJump OR Dash OR Glide

  conn UpperReach.TreeRoom:
    moki: UpperReach.KeystoneDoor
  # backwards connection can't get through the Icefall

anchor UpperReach.TreeRoom at -107, -3933:  # At the tree
  refill Energy=4:  # fast respawning crystal
    moki: Weapon

  quest UpperReach.SpringSeed:
    moki: Grenade=1

  pickup UpperReach.LightBurstTree:
    moki: free
  pickup UpperReach.WellEX:
    moki: free
  pickup UpperReach.HiddenEX:
    moki: Grenade=1
  # backwards connection can't get through the Icefall

anchor LowerReach.SecondSoup at -316, -4037:  # Next to the soup below the teleporter
  state LowerReach.CentralFurnace:
    moki: DoubleJump, Dash, Bash, Flap

  pickup LowerReach.MeltIceEX:
    moki: Grenade=1
  pickup LowerReach.BurrowEX:
    moki: Burrow, DoubleJump OR Dash OR Glide OR Launch

  conn LowerReach.Central:
    moki:
      DoubleJump, Bash, Flap OR Grenade=1
      DoubleJump, Burrow
      Launch
  conn LowerReach.WindChannel:
    moki: ShieldEnemyObstacle

anchor LowerReach.WindChannel at -256, -4035:  # The furnace left of the wind channel connecting to east reach
  refill Checkpoint
  refill Energy=3:
    moki: ShieldEnemyObstacle, DoubleJump OR Dash OR Launch

  state LowerReach.CentralFurnace:
    moki: Grenade=1

  pickup LowerReach.BelowLupoEX:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch
      LowerReach.CentralFurnace, DoubleJump OR Dash
  pickup LowerReach.BreakWallEX:
    moki: BreakWall=20, ShieldEnemyObstacle OR Bash
  pickup LowerReach.WindBottomEX:
    moki: Grenade=1, Glide  # grenade to light the lantern
  pickup LowerReach.WindHiddenEX:
    moki: Grenade=1, Glide  # grenade to light the lantern

  conn LowerReach.SecondSoup:
    moki:
      ShieldEnemyObstacle, DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=1
  conn LowerReach.SoupMoki:
    moki: Grenade=1, Glide  # grenade to light the lantern

anchor LowerReach.SoupMoki at -240, -3989:  # Below the reach teleporter, where you hand delicious marshclam soup to a moki (or alternatively extuingish his fireplace...)
  refill Energy=4:
    moki: Weapon

  quest LowerReach.HandToHandHat:
    moki: GladesTown.HandToHandSoup

  pickup LowerReach.WindHiddenEX:
    moki:
      DoubleJump, Dash, Glide
      Launch, Glide

  conn LowerReach.WindChannel:
    moki: Glide
  conn LowerReach.East:
    moki:
      DoubleJump, Dash, Bash, Grenade=2
      Launch

anchor LowerReach.East at -182, -3968:  # Right of the Lantern opening the Tp room
  refill Checkpoint
  refill Full:  # use the teleporter
    moki: Bash, Grenade=2, DoubleJump OR Dash OR Glide OR Launch
  # could be considered moving this anchor to the left, closer to the teleporter, if it gets important on higher difficulties

  state LowerReach.RolledSnowball:
    moki: EnemyObstacle, Grenade=1

  pickup LowerReach.SnowballHC:
    moki: LowerReach.RolledSnowball, Burrow, DoubleJump OR Dash OR Glide OR Launch OR Danger=20

  conn LowerReach.Teleporter:
    moki:
      Grenade=1, DoubleJump OR Dash OR Glide OR Launch
      Bash, Grenade=2
  conn LowerReach.SoupMoki: free
  conn LowerReach.PastSnowball:
    moki, LowerReach.RolledSnowball:
      DoubleJump OR Glide OR Launch
      Bash, Grenade=1, Dash
      Bash, Grenade=2

anchor LowerReach.PastSnowball at -99, -3982:  # At the bashnade pedestal after rolling the snowball
  refill Checkpoint
  refill Energy=4:  # fast respawning crystal
    moki: Weapon

  state LowerReach.EastDoorLantern:
    moki:
      Bash, Grenade=2, DoubleJump, Dash, Glide
      Grenade=1, Launch

  pickup LowerReach.RoofLeftEX:
    moki:
      LowerReach.CoolEastFurnace, Bash, Grenade=2, DoubleJump, Dash, Glide  # blame moon
      Launch, DoubleJump, Dash OR Glide
      Bash, Grenade=1, Launch
  pickup LowerReach.RoofRightEX:
    moki:
      LowerReach.CoolEastFurnace, Bash, Grenade=2
      Launch

  conn LowerReach.SwimmingPool:
    moki:
      Bash, Grenade=1, DoubleJump, Dash, Glide
      Launch
    # shuriken break note: this wall has 20 health
  # backwards path can't get past the snowball

anchor LowerReach.SwimmingPool at -44, -4001:  # At the platform in the freezable water
  refill Energy=4:
    moki: Weapon, LowerReach.CoolEastFurnace OR Water

  state LowerReach.HeatEastFurnace:
    moki:
      Bash, Grenade=2
      Grenade=1, Launch
  state LowerReach.CoolEastFurnace:  # the intentional path is to cool this furnace
    moki:
      Flap, Bash, Grenade=1
      Flap, Launch

  pickup LowerReach.FractureShard:
    moki: LowerReach.HeatEastFurnace, Water

  conn LowerReach.ArenaArea:
    moki, LowerReach.EastDoorLantern:
      LowerReach.CoolEastFurnace, Bash, Grenade=1
      Launch, LowerReach.CoolEastFurnace OR DoubleJump OR Dash OR Glide
  conn LowerReach.PastSnowball:
    moki, BreakWall=20:
      Bash, Grenade=1
      Launch

anchor LowerReach.ArenaArea at 44, -3992:  # To the left of the combat arena
  refill Checkpoint
  refill Health=1: free
  refill Energy=3:
    moki:
      Weapon, DoubleJump, Dash
      Weapon, Launch
      RangedWeapon

  state LowerReach.ArenaBeaten:
    moki: Combat, Danger=40, Hammer OR Launch

  conn LowerReach.Trial:
    moki: LowerReach.ArenaBeaten
  conn LowerReach.WispPath:
    moki, LowerReach.ArenaBeaten:
      Glide, Grapple OR Launch
      Glide, DoubleJump, Bash, Grenade=1
  # backwards path can't get through the door

anchor LowerReach.WispPath at 83, -3874:  # Halfway through the climb
  refill Checkpoint
  refill Health=1:
    moki:
      Grapple OR Launch
      Bash, Grenade=1  # wasted energy...
  refill Energy=4:
    moki:
      DoubleJump, Grapple
      DoubleJump, Bash, Grenade=1  # wasted energy...
      Dash, Danger=20, Grapple
      Dash, Danger=20, Bash, Grenade=1  # wasted energy...
      Launch

  conn LowerReach.SnowEscape:
    moki:
      Bash, Grenade=5, Glide, DoubleJump
      Bash, Grenade=4, Glide, Grapple
      Bash, Glide, Launch
  # backwards path can't get through the arena ceiling

anchor LowerReach.SnowEscape:
  refill Full
  quest LowerReach.ForestsMemory:  # currently based on the requirements of getting here to simplify
    moki, LowerReach.ArenaBeaten:
      Dash, Bash, Grapple, Glide, Water OR DoubleJump
      Bash, Glide, Launch
  pickup LowerReach.EscapeRevisitEX:
    moki: LowerReach.ForestsMemory

anchor LowerReach.Trial at 64, -4046:  # At trial start
  refill Checkpoint

  state LowerReach.KeystoneDoor:
    moki: Keystone=4
  # state LowerReach.TrialActivation:
  #   moki: LowerReach.KeystoneDoor
  state LowerReach.BearSneezed:
    moki: LowerReach.ForestsMemory  # the game forces Baur awake when collecting the wisp

  pickup LowerReach.RightKS:
    moki:
      Glide
      DoubleJump, Dash, Bash, Grenade=1
      Launch, DoubleJump OR Danger=20
  pickup LowerReach.UpperLeftKS:
    moki: Glide
  pickup LowerReach.MiddleLeftKS:
    moki: Glide
  pickup LowerReach.BottomLeftKS:
    moki: Glide
  pickup LowerReach.TrialEX:
    moki: Glide

  conn GladesTown.ReachPath:
    moki: Glide

region UpperDepths:
  moki: Danger=40, Regenerate
  unsafe: free

anchor UpperDepths.Entry at 161, -4340:  # The little standable ground below the entrance
  pickup UpperDepths.EntrySpikesEX:
    moki: Glide

  conn UpperDepths.FirstFirefly:
    moki: EnemyObstacle, Glide, RangedWeapon OR Bash

anchor UpperDepths.FirstFirefly at 211, -4391:  # Where the Voice dialogue plays
  refill Checkpoint

  pickup UpperDepths.EntryRoofEX:
    moki:
      Bash, DoubleJump OR Dash
      DoubleJump, Dash, Grapple
      Launch
  pickup UpperDepths.EntryOre:
    moki:
      Weapon, Grapple, DoubleJump  # weapon to kill the enemy
      Bash, DoubleJump OR Grapple
      Launch
  pickup UpperDepths.LeftEntryKS:
    moki, EnemyObstacle:
      BreakWall=1, Grapple, DoubleJump OR Dash OR Glide
      BreakWall=1, Launch
      Bow=1

  conn UpperDepths.Entry:
    moki: EnemyObstacle, Glide, RangedWeapon OR Bash
  conn UpperDepths.FirstKSRoom: free

anchor UpperDepths.FirstKSRoom at 223, -4420:  # Below the first firefly egg
  refill Energy=3:  # this crystal is in the darkness
    unsafe: Weapon

  state UpperDepths.EntryKeystoneDoor:
    moki, Keystone=2:
      DoubleJump, Grapple
      Bash, Grenade=1, DoubleJump OR Dash OR Glide OR Grapple
      Launch
  state UpperDepths.LightPuzzle:  # breaking the corruption blocking the light
    moki, UpperDepths.EntryKeystoneDoor, BreakWall=16, BreakWall=16:
      DoubleJump, Bash, Grapple
      Bash, Launch

  pickup UpperDepths.RightEntryKS:
    moki:
      Grapple, DoubleJump
      Launch, DoubleJump OR Dash OR Glide OR Grapple
  pickup UpperDepths.LeftEntryKS:
    moki: EnemyObstacle, DepthsLight
  pickup UpperDepths.SwimEC:
    moki: EnemyObstacle, DepthsLight, Water

  conn UpperDepths.FirstFirefly:
    moki, EnemyObstacle:
      Grapple, DoubleJump
      Launch, DoubleJump OR Grapple
  conn UpperDepths.BelowHive:
    moki, UpperDepths.EntryKeystoneDoor, UpperDepths.LightPuzzle OR DepthsLight:
      Bash, DoubleJump, Grapple
      Bash, Grenade=1, DoubleJump OR Dash OR Glide OR Grapple
      Launch

anchor UpperDepths.BelowHive at 422, -4402:  # Below the Hive, on top of the tunnel leading downwards
  refill Checkpoint
  refill Full:  # use the teleporter
    moki: BreakWall=1, Grapple OR Launch
  refill Energy=3:
    moki: Weapon, DoubleJump OR Launch

  state UpperDepths.EntryKeystoneDoor:
    moki: Keystone=2, DepthsLight, DoubleJump OR Dash OR Glide OR Launch

  pickup UpperDepths.HiveEX:
    moki: Bash OR Launch
  pickup UpperDepths.RightEntryKS:
    moki: DepthsLight, Launch

  conn UpperDepths.FirstKSRoom:
    moki: UpperDepths.EntryKeystoneDoor, DepthsLight, DoubleJump OR Dash OR Glide OR Launch
  conn UpperDepths.Teleporter:
    moki: Grapple OR Launch
  conn UpperDepths.Central:
    moki: DepthsLight, DoubleJump OR Dash OR Glide OR Launch  # a bit scary...
  conn UpperDepths.LowerConnection:
    moki: DepthsLight  # a bit scary...

anchor UpperDepths.Teleporter at 513, -4361:  # The spirit well
  refill Full

  pickup UpperDepths.TeleporterEX: free  # just a few steps away in the darkness

  conn Teleporters: free
  conn UpperDepths.BelowHive:
    moki:
      RangedWeapon
      BreakWall=1, Launch
      DepthsLight
  conn UpperDepths.Central:
    moki:
      RangedWeapon, DoubleJump OR Dash OR Glide OR Launch  # a bit scary...
      BreakWall=1, Launch

anchor UpperDepths.Central at 464, -4484:  # The firefly egg to the right of the second keystone door
  refill Checkpoint
  refill Energy=3:  # in the dark
    unsafe: Weapon, Launch

  state UpperDepths.CentralKeystoneDoor:
    moki: Keystone=2

  conn UpperDepths.SecondKSRoom:
    moki: EnemyObstacle, DepthsLight OR BreakWall=1
  conn UpperDepths.LowerConnection:
    moki: UpperDepths.CentralKeystoneDoor
  conn UpperDepths.BelowHive:
    moki: DepthsLight, Launch
  conn UpperDepths.Teleporter:
    moki, BreakWall=20:
      DepthsLight, DoubleJump, Dash, Grapple
      DepthsLight, Launch

anchor UpperDepths.SecondKSRoom at 542, -4467:  # The egg of the firefly circling through the keystone room
  refill Checkpoint
  refill Energy=4:
    moki: Weapon
  # a great number of energy crystals on the way through the dark have not been considered (nor is flash consumption considered...)

  quest UpperDepths.LightcatcherSeed:
    moki:
      DepthsLight, DoubleJump, Dash, Grapple
      Weapon, DepthsLight, DoubleJump, Dash, Bash, Grenade=1  # weapon to clear the place for bashgrenading
      DepthsLight, Launch

  pickup UpperDepths.RightHealthKS:
    moki: BreakWall=1 OR DepthsLight
  pickup UpperDepths.LeftHealthKS:
    moki:
      BreakWall=1, DoubleJump, Dash OR Glide
      DepthsLight, DoubleJump, Dash OR Glide
      DepthsLight, DoubleJump, Bash, Grenade=1
      Launch, BreakWall=1 OR DepthsLight
  pickup UpperDepths.KeystoneHC:
    moki:
      BreakWall=1, DoubleJump, Dash, Glide
      DepthsLight, DoubleJump, Dash OR Glide
      Launch, BreakWall=1 OR DepthsLight
  pickup UpperDepths.BossPathEX:
    moki:
      DepthsLight, DoubleJump, Dash
      DepthsLight, DoubleJump, Bash, Grenade=1
      DepthsLight, Launch

  conn UpperDepths.Central:
    moki: EnemyObstacle, DepthsLight OR BreakWall=1
  conn MoraFight:
    moki:
      DepthsLight, DoubleJump, Grapple, Dash OR Glide
      DepthsLight, Launch
  conn UpperDepths.Teleporter:
    moki, BreakWall=20:
      DepthsLight, DoubleJump, Grapple, Dash OR Glide
      DepthsLight, Launch

anchor MoraFight:
  refill Full
  quest UpperDepths.ForestsEyes:
    moki, Combat, Danger=95:
      DepthsLight, Bash, Grapple, DoubleJump OR Dash
      DepthsLight, Bash, Grapple, Launch

anchor UpperDepths.LowerConnection at 423, -4475:  # The firefly egg to the left of the second keystone door
  refill Checkpoint
  # energy crystal on the way to the trial not considered

  state UpperDepths.CentralKeystoneDoor:
    moki: Keystone=2

  pickup LowerDepths.BelowDoorOre:
    moki: DepthsLight  # It's hidden in a dark area, not hard to reach.
  pickup LowerDepths.LeftEX:
    moki:
      BreakWall=1, DoubleJump OR Dash OR Glide OR Launch
      DepthsLight, DoubleJump OR Dash OR Glide OR Launch

  conn UpperDepths.BelowHive:
    moki, BreakWall=1 OR DepthsLight:
      DoubleJump, Grapple
      Launch
  conn UpperDepths.Central:
    moki: UpperDepths.CentralKeystoneDoor
  conn LowerDepths.West:
    moki:
      BreakWall=1, Dash, DoubleJump OR Glide
      DepthsLight, DoubleJump, Dash
      DepthsLight, Glide
      Launch, BreakWall=1 OR DepthsLight
  conn LowerDepths.Central:
    moki:  # the paths in the dark are a bit treacherous...
      BreakWall=1, DoubleJump, Dash, Bash OR Glide
      BreakWall=1, Launch, DoubleJump OR Glide
      DepthsLight, DoubleJump, Dash, Bash OR Glide
      DepthsLight, Bash, Glide
      DepthsLight, Bash, Grenade=1, DoubleJump OR Dash OR Glide
      DepthsLight, Launch, DoubleJump OR Dash OR Bash OR Glide

region LowerDepths:
  moki: Danger=40, Regenerate
  unsafe: free

anchor LowerDepths.West at 322, -4510:  # At the Moki needing a Lantern
  refill Checkpoint
  refill Health=1:  # to the left
    unsafe:
      DoubleJump, Dash OR Glide
      Bash OR Launch
  refill Energy=3:  # to the left
    unsafe:
      DoubleJump, Dash OR Glide
      Bash OR Launch

  quest LowerDepths.HandToHandSilk:
    moki: GladesTown.HandToHandLantern

  pickup LowerDepths.SwimEC:
    moki: DepthsLight, Water

  conn DepthsShrine:
    moki:
      DepthsLight, Water, DoubleJump, Bash
      DepthsLight, Water, Bash, Grenade=1, Dash OR Glide
      DepthsLight, Water, Launch
    # shuriken break note: this wall has 20 health
  conn UpperDepths.LowerConnection:
    moki: DepthsLight, Launch
  conn LowerDepths.Central:
    moki:
      BreakWall=1, DoubleJump, Dash, Bash OR Glide
      BreakWall=1, Launch, DoubleJump OR Glide

anchor DepthsShrine:
  refill Full
  pickup LowerDepths.CombatShrine:
    moki, Combat, Bash:
      Danger=65
      Danger=60, DoubleJump OR Dash
      Danger=50, Launch

anchor LowerDepths.Central at 482, -4536:  # Below where the trial starts
  refill Checkpoint

  pickup LowerDepths.RaceStartHC:
    moki:
      DoubleJump, Grapple, Dash OR DepthsLight
      Launch

  conn LowerDepths.East:
    moki:
      Bash, DoubleJump, Dash OR Glide
      Launch, DoubleJump OR Dash OR Bash OR Glide
  conn UpperDepths.LowerConnection:
    moki:
      DepthsLight, Launch, Bash
      DepthsLight, Bash, DoubleJump

anchor LowerDepths.East at 570, -4550:  # The lit up room on the trial path
  refill Checkpoint
  refill Energy=3:
    moki: Weapon
  refill Energy=3:
    moki, Weapon:
      Bash, DoubleJump OR Dash OR Glide
      Launch

  # state LowerDepths.TrialActivation:
  #   moki:
  #     DoubleJump, Bash, Grenade=3
  #     DoubleJump, Bash, Grenade=2, Grapple
  #     DoubleJump, Dash, Bash, Grapple
  #     Bash, Grapple, Glide
  #     Launch
  pickup LowerDepths.SpiritSurgeShard:
    moki:
      DoubleJump, Grapple, Dash OR Glide
      Launch, DoubleJump OR Dash OR Grapple OR Glide
  pickup LowerDepths.LupoMap:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Launch, DoubleJump, Dash
      Launch, Glide
      DepthsLight, Glide
      DepthsLight, Launch, DoubleJump OR Dash

  conn UpperDepths.SecondKSRoom:
    moki, BreakWall=20:
      DepthsLight, DoubleJump, Bash, Grapple
      DepthsLight, Launch
  conn LowerDepths.TreeArea:
    moki:
      BreakWall=1, DoubleJump, Bash, Grapple, Dash OR Glide
      BreakWall=1, Launch, Bash, DoubleJump, Dash
      BreakWall=1, Launch, Bash, Glide
      BreakWall=1, Launch, Grapple, DoubleJump OR Dash OR Bash OR Glide
      DepthsLight, Bash, Grapple, DoubleJump OR Dash OR Glide
      DepthsLight, Launch, Bash OR Grapple
  conn LowerDepths.Central:
    moki:
      Bash, DoubleJump OR Launch
      DepthsLight, Launch, DoubleJump, Dash OR Glide

anchor LowerDepths.TreeArea at 776, -4542:  # The flash tree
  refill Checkpoint
  refill Energy=4:
    moki: Weapon

  # there could be a path to activate the trial here, but these aren't used currently...

  pickup LowerDepths.FlashTree: free
  pickup LowerDepths.RightEX:
    moki: DepthsLight OR Launch

  conn LowerDepths.East:
    moki:
      DepthsLight, Glide OR Launch
      DepthsLight, DoubleJump, Bash OR Grapple
      DepthsLight, Dash, Bash OR Grapple

region PoolsApproach:
  moki: Danger=25
  unsafe: free

anchor PoolsApproach.MillPathCheckpoint at -826, -4130:  # The checkpoint halfway between Mill Approach and Mill Path (added mostly because the paths through here reached ridiculous complexity otherwise)
  refill Checkpoint

  conn WestGlades.MillApproach:
    moki:
      Water, Grapple, DoubleJump, Dash OR Glide
      Water, Grapple, Bash, Grenade=1, Dash, Glide
      Water, Launch, DoubleJump OR Dash OR Grapple OR Glide  # go up the left wall
  conn PoolsApproach.MillPath:
    moki, EnemyObstacle, Danger=20:  # severe enemy spam
      Bash, Grapple OR Launch  # this is probably actually closest to how you'd traverse this naturally
      Grapple, DoubleJump OR Dash  # go through the gap from above, you can use Grapple to reset if you fall
      Launch, DoubleJump OR Grapple

anchor PoolsApproach.MillPath at -873, -4146:  # above the water where the three paths merge
  refill Checkpoint

  pickup PoolsApproach.MillPathEX:
    moki:
      Bash, DoubleJump OR Dash
      RangedWeapon, DoubleJump, Dash
      RangedWeapon, DoubleJump, Grapple, Glide  # solvable either through the right grapple point or using the wrap-around taught at glades shrine
      Launch
  pickup PoolsApproach.MillPathEC:
    moki: Water  # again not really a reason to even use Bash

  conn PoolsApproach.MillPathCheckpoint:
    moki, EnemyObstacle, Danger=20:  # severe enemy spam
      Bash, DoubleJump  # bash errything
      Weapon, Bash, Grenade=3, Dash OR Glide  # clear the space to bashnade
      Weapon, Bash, Grenade=2, Grapple, Dash OR Glide  # clear the space to bashnade
      DoubleJump, Grapple, Dash OR Glide
      Launch, DoubleJump OR Dash OR Bash OR Glide
  conn PoolsApproach.RightOfWheel:
    moki: EnemyObstacle, Water  # bashing to break the wall on the way is much harder than just swimming at it and letting it happen, so didn't make Bash a requirement.

anchor PoolsApproach.RightOfWheel at -948, -4184:  # The rightmost platform of the static wheel
  pickup PoolsApproach.AboveWheelEX:
    moki:
      # grenadebash doesn't work as well when the wheel spins
      PoolsApproach.WheelFreed, DoubleJump
      Launch
  pickup PoolsApproach.MillPathHC:
    moki:
      Water, DoubleJump, Dash, WaterDash, Grapple
      Water, DoubleJump, Grapple, Launch
    unsafe:
      Water, WaterDash, DoubleJump, Grapple
      Water, Grapple, Launch
  pickup PoolsApproach.MillPathEC:
    moki: Water, Bash, Danger=10

  conn MarshPastOpher.PoolsPathWest:
    moki, BreakWall=20:
      Water, DoubleJump, WaterDash, Grapple  # maybe not obvious?
      Water, Grapple, Launch
    unsafe:
      BreakWall=20, Water, WaterDash, Grapple, Dash OR Sword
  conn PoolsApproach.LeftOfWheel:
    moki:
      PoolsApproach.WheelFreed OR DoubleJump OR Grapple OR Launch
      Bash, Grenade=1
  conn EastPools.Entry:
    moki:
      # grenadebash doesn't work as well when the wheel spins
      Glide, Launch
      Bash, Grenade=1, Launch, DoubleJump OR Dash
      DoubleJump, Dash, Launch, Danger=20
      PoolsApproach.WheelFreed, DoubleJump, Glide
    unsafe:
      Launch, Dash
  conn PoolsApproach.MillPath:
    moki:
      Water, Bash, Danger=10, Grapple, DoubleJump, Dash OR Glide
      Water, Bash, WaterDash
      Water, Bash, Danger=10, Launch

anchor PoolsApproach.LeftOfWheel at -995, -4184:  # The leftmost platform of the static wheel
  state PoolsApproach.WheelFreed:
    moki: Water, Bash

  pickup PoolsApproach.CurrentEX:
    moki: Water, WaterDash
  pickup PoolsApproach.BurrowsPathEX:
    moki:
      Water, WaterDash, DoubleJump, Dash, Danger=10
      Water, WaterDash, Glide, DoubleJump OR Dash
      Water, WaterDash, Bash, DoubleJump OR Glide
      Water, WaterDash, Launch, DoubleJump OR Dash OR Bash OR Glide OR Danger=10
    unsafe:
      Water, Dash, Glide, WaterDash

  conn PoolsApproach.RightOfWheel:
    moki:
      # grenadebash doesn't work when the wheel spins
      PoolsApproach.WheelFreed, Water
      DoubleJump OR Launch
  conn EastPools.Entry:
    moki: Water, Launch
    unsafe: Water, DoubleJump, WaterDash, Damage=20
  conn MarshSpawn.Main:
    moki: Water, WaterDash  # <3

region EastPools:
  moki: Danger=40, Regenerate
  unsafe: free

anchor EastPools.Entry at -1122, -4166:  # At the Voice dialogue
  refill Checkpoint
  refill Health=1: free

  # The first bubbles here only spawn if you have Flap!
  pickup EastPools.TwoCrushersEX:
    moki: Water, WaterDash

  conn EastPools.LeverRoom:
    moki:
      Flap OR Launch
      Bash, Grenade=1
  conn PoolsApproach.LeftOfWheel:
    moki:
      Water
      Bash, Grenade=1, Glide
      Glide, Launch
      DoubleJump, Dash, Launch
      Bash, Grenade=1, Launch, DoubleJump OR Dash

anchor EastPools.LeverRoom at -1160, -4152:  # At the amulet Moki
  refill Checkpoint

  state EastPools.EntryLever:
    moki, EnemyObstacle:
      DoubleJump, Dash OR Glide
      Dash, Glide
      Launch
  state EastPools.BelowTokkBubbleFree:
    moki:
      EastPools.EntryLever, Water, Bash
    unsafe, EastPools.EntryLever:
      Water, WaterDash
      Water, Bow=1 OR Grenade=1

  quest EastPools.KwoloksWisdomAmulet: free

  pickup EastPools.RightOre:
    moki:
      DoubleJump, Grapple, Flap, Dash OR Glide  # kinda weird, but I guess this is the casual way?
      Launch, Grapple
    unsafe:
      Dash, Grapple, Glide, Flap
  pickup EastPools.CurrentEX:
    moki: Water, WaterDash
  pickup EastPools.BelowLeverEX:
    moki:  # kinda dangerous with the spikes? but damage seemed mostly avoidable
      DoubleJump, Bash, Grenade=1
      Hammer, DoubleJump OR Dash OR Glide
      Spear=1, DoubleJump OR Dash OR Glide
      Launch
  pickup EastPools.AboveDoorOre:
    moki, EastPools.EntryLever:  # other paths would be redundant with the paths coming from tokk
      Bash, Grenade=2
      Bash, Grenade=1, DoubleJump OR Grapple

  conn EastPools.TPArea:
    moki, EastPools.EntryLever:
      EastPools.BelowTokkBubbleFree, EnemyObstacle, Grapple, Flap, DoubleJump OR Dash OR Glide
      DoubleJump, Bash, Grenade=1  # bashgrenade above
      Bash, Grenade=2, Dash OR Glide  # bashgrenade above
      EnemyObstacle, Bash, Grenade=2, EastPools.BelowTokkBubbleFree OR Water  # bashgrenade below
      Launch
  conn EastPools.Entry: free

anchor EastPools.TPArea at -1297, -4143:  # Where Tokk stands
  refill Checkpoint
  refill Full:  # use the teleporter
    moki: EastPools.LowerWaterDrained

  state EastPools.BelowTokkBubbleFree:
    moki:
      Water, Bash
    unsafe:
      Water, WaterDash
      Water, Bow=1 OR Grenade=1
  state EastPools.LowerWaterDrained:
    moki: Water OR EastPoolsTP
  # There are two Arenas here: you get one if you enter without WaterDash and another if you enter with it.
  # This path is assuming the worse case of getting the strictly harder WaterDash arena, but doesn't list WaterDash
  # explicitly because you don't need it unless you have it.
  # And any other way would lock basically all of Pools behind WaterDash. So it makes sense, right?
  # Also, for now this state includes breaking the purple wall before the arena because everything else would be dumb
  state EastPools.FightArenas:
    moki: EastPools.LowerWaterDrained, Combat, Water, Bash

  quest EastPools.HandToHandSpyglass:
    moki, LowerDepths.HandToHandSilk:
      Grapple, DoubleJump OR Dash OR Glide
      DoubleJump, Bash, Grenade=1
      Launch
  quest EastPools.GrassSeed:
    moki, EastPools.FightArenas:
      Water, Bash, WaterDash OR Launch
      Water, Bash, DoubleJump, Dash OR Glide
      Water, Bash, Dash, Glide
      Water, Bash, Grenade=1, DoubleJump OR Dash OR Glide

  pickup EastPools.AboveDoorOre:
    moki:
      EastPools.BelowTokkBubbleFree, Grapple, Flap, DoubleJump OR Dash
      Bash, Grenade=1, DoubleJump OR Dash OR Glide OR Grapple
      Bash, Grenade=2
      Launch
  pickup EastPools.AboveTpEX:
    moki:  # these need water to not be softlockable with the player draining the upper water
      Water, DoubleJump, Bash, Grenade=2
      Water, DoubleJump, Grapple, Bash, Grenade=1
      Water, Launch
  pickup EastPools.PurpleWallHC:
    moki, UpperPools.UpperWaterDrained:
      Water, WaterDash, Bash, Grenade=3, DoubleJump
      Water, WaterDash, Bash, Grenade=2, DoubleJump, Grapple
      Water, WaterDash, Bash, Launch
  pickup EastPools.LupoOre:
    moki: Water
  pickup EastPools.UltraBashShard:
    moki: EastPools.LowerWaterDrained, Water, Bash
  pickup EastPools.FightRoomHC:
    moki, EastPools.FightArenas, WaterDash:  # The HC only gets unlocked if you finish the alternate WaterDash arena; FightArenas doesn't have WaterDash as requirement included for reasons explained above, so it's needed here
      DoubleJump, Dash OR Grapple
      Bash, Grenade=1
      Launch
  pickup EastPools.EnergyHarvestShard:
    moki, EastPools.FightArenas:
      Water, WaterDash, DoubleJump
      Bash, Grenade=1
      Launch
  pickup EastPools.LupoEX:
    moki: EastPools.FightArenas, Water, Bash
  pickup EastPools.LupoMap:
    moki: EastPools.FightArenas, Water, Bash
  pickup EastPools.BehindCrusherEX:
    moki: EastPools.FightArenas, Water

  conn EastPools.Teleporter:
    moki: EastPools.LowerWaterDrained
  conn EastPools.LeverRoom:
    moki, EastPools.EntryLever, EnemyObstacle:
      DoubleJump OR Dash OR Glide OR Launch  # go above
      Bash, Grenade=1  # go above
      Grapple  # go below
  conn WestPools:
    moki: EastPools.FightArenas, Water, Bash, WaterDash, DoubleJump OR Dash OR Glide OR Launch
  conn UpperPools.KeystoneRoom:
    moki, EastPools.FightArenas, EnemyObstacle:
      Water, Bash, DoubleJump, Dash OR Glide
      Water, Bash, Launch

anchor EastPools.Teleporter at -1316, -4153:  # At the teleporter after draining the water - this is to specify the refill and randos behaviour of draining the water if you grab the tp pickup
  refill Full

  state EastPools.LowerWaterDrained: free  # this is, uh... correct, I suppose xD

  conn Teleporters: free
  conn EastPools.TPArea: free

region UpperPools:
  moki: Danger=40, Regenerate
  unsafe: free

anchor UpperPools.KeystoneRoom at -1540, -4095:  # Autosave below the two upper left keystones
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  state UpperPools.KeystoneRoomBubbleFree:
    moki:
      Water, WaterDash
      Water, Bash
    unsafe: Bow=1 OR Grenade=1

  quest EastPools.GrassSeed:
    moki: EnemyObstacle

  pickup UpperPools.LowerKS:
    moki:
      Water, DoubleJump, Bash
      Water, WaterDash OR Launch
  pickup UpperPools.UpperLeftKS:
    moki:
      Bash, Grenade=1
      UpperPools.KeystoneRoomBubbleFree, DoubleJump, Flap
      Launch
  pickup UpperPools.UpperMidKS:
    moki:
      DoubleJump, Bash, Grenade=1
      Bash, Grenade=2, DoubleJump OR Dash OR Glide
      Grapple, DoubleJump OR Dash OR Glide
      Launch
  pickup UpperPools.UpperRightKS:
    moki:
      Bash, Grenade=1, Water OR DoubleJump OR Dash OR Glide
      Grapple, DoubleJump OR Glide OR Dash
      Water, WaterDash, DoubleJump
      Launch

  conn UpperPools.BeforeKeystoneDoor:
    moki:
      Grapple, DoubleJump OR Dash OR Glide
      Water, Grapple, Bash, Grenade=1
      Bash, Grenade=2, Water OR DoubleJump OR Dash OR Glide
      Bash, Grenade=3
      Launch
  conn UpperPools.BubbleSpamRoom:
    moki: Flap, DoubleJump, Dash, Grapple  # seems to be intended
  conn WestPools:
    moki: Water, WaterDash, EnemyObstacle OR DoubleJump OR Dash OR Glide OR Launch

anchor UpperPools.BeforeKeystoneDoor at -1483, -4076:  # In front of the door blocking waterdash tree
  refill Health=1:
    moki: DoubleJump OR Dash OR Glide OR Grapple OR Launch

  state UpperPools.KeystoneDoor:
    moki: Keystone=4
  # state UpperPools.TrialActivation:
  #   moki: DoubleJump OR Grapple OR Launch

  pickup UpperPools.UpperMidKS:
    moki:
      DoubleJump OR Dash
      Grapple, Glide

  conn UpperPools.TreeArea:
    moki: UpperPools.KeystoneDoor
  conn UpperPools.KeystoneRoom:
    moki: Water OR DoubleJump OR Dash OR Glide OR Launch  # don't really need anything, but eh
  conn UpperPools.BubbleSpamRoom:
    moki:
      DoubleJump, Bash, Grenade=1
      Launch

anchor UpperPools.TreeArea at -1467, -4075:  # The ledge left of waterdash tree
  refill Checkpoint

  state UpperPools.KeystoneDoor:
    moki: Keystone=4
  state UpperPools.UpperWaterDrained:
    moki:
      Water, WaterDash, Grapple, DoubleJump OR Launch
      Water, WaterDash, Launch, DoubleJump, Dash OR Glide

  pickup UpperPools.SwimDashTree: free
  pickup UpperPools.CurrentEX:
    moki: Water, WaterDash
  pickup UpperPools.RoofEX:
    moki:
      Water, WaterDash, Flap, DoubleJump OR Dash
      Water, WaterDash, Launch
    unsafe: Launch  # use the small bubbles
  pickup UpperPools.WaterfallEC:
    moki:
      Water, WaterDash, DoubleJump, Dash, Grapple
      Water, WaterDash, DoubleJump, Bash, Grenade=1, Grapple
      Water, WaterDash, Launch
    unsafe:  # these are maybe probably not moki. Might be valid for gorlek
      Water, WaterDash, Grapple, DoubleJump OR Dash
      Water, WaterDash, Grapple, Bash, Grenade=1
  pickup EastPools.PurpleWallHC:
    moki, UpperPools.UpperWaterDrained:
      Water, WaterDash, DoubleJump, Dash, Bash, Grapple
      Water, WaterDash, DoubleJump, Bash, Grenade=1, Grapple
      Water, WaterDash, Bash, Launch
  pickup EastPools.AboveTpEX:
    moki, UpperPools.UpperWaterDrained:
      Water, WaterDash, DoubleJump, Dash, Grapple
      Water, WaterDash, DoubleJump, Bash, Grenade=1, Grapple
      Water, WaterDash, Launch

  conn UpperPools.BeforeKeystoneDoor:
    moki: UpperPools.KeystoneDoor
  conn EastPools.TPArea:
    moki, UpperPools.UpperWaterDrained:
      Water, WaterDash, DoubleJump, Dash, Grapple
      Water, WaterDash, DoubleJump, Bash, Grenade=1, Grapple
      Water, WaterDash, Launch

anchor UpperPools.BubbleSpamRoom at -1586, -4053:  # To the right of where all the bubbles rise
  refill Checkpoint

  pickup UpperPools.FishPoolEX:
    moki: Water, Bash OR WaterDash OR Danger=10  # just in case someone's troubled by the fish
  pickup UpperPools.FishPoolOre:
    moki:
      DoubleJump, Bash, Dash OR Glide
      Bash, Grenade=1
      Launch
  pickup UpperPools.LeftBubblesEX:  # Beautiful autosave placement right there
    moki: Water
  pickup UpperPools.RightBubblesEX:
    moki:
      Water, Bash, DoubleJump OR Launch
      Water, WaterDash
    unsafe: Water, Grenade=1
  pickup UpperPools.BubblesEC:
    moki:
      DoubleJump, Dash OR Glide
      Launch, DoubleJump OR Dash OR Glide
  pickup UpperPools.UpperMidKS:
    moki: DoubleJump OR Dash OR Glide

  conn UpperPools.KeystoneRoom:
    moki: Water OR DoubleJump OR Dash OR Glide OR Launch
  conn UpperPools.BeforeKeystoneDoor: free

region WestPools:
  moki: Danger=40, Regenerate
  unsafe: free

anchor WestPools at -1656, -4171:  # the west Pools TP
  refill Full

  quest EastPools.GrassSeed:
    moki: Water, WaterDash

  pickup WestPools.TpEX:
    moki:
      Water, WaterDash, DoubleJump, Dash  # hard on keyboard, but I guess this is intended, and no other ability would even help
      Launch
  pickup WestPools.BurrowEX:
    moki: Water, Burrow
  pickup WestPools.BurrowOre:
    moki: WestPools.ForestsStrength, EnemyObstacle, Water, WaterDash, Burrow
  pickup WestPools.EscapeRevisitEX:
    moki: WestPools.ForestsStrength, EnemyObstacle, Water, DoubleJump OR WaterDash OR Launch
  pickup UpperPools.LowerKS:
    moki: WestPools.ForestsStrength, EnemyObstacle, Water, WaterDash

  conn Teleporters: free
  conn KwolokFight:
    moki: Water, WaterDash OR DoubleJump OR Launch
  conn UpperPools.KeystoneRoom:
    moki, EnemyObstacle:
      Water, WaterDash, Bash, DoubleJump, Dash OR Glide
      Water, WaterDash, Bash, Launch
      WestPools.ForestsStrength, Water, WaterDash, DoubleJump
      WestPools.ForestsStrength, Water, WaterDash, Bash, Grenade=1, Dash

anchor KwolokFight:
  refill Full
  quest WestPools.ForestsStrength:
    moki: Combat, Water, WaterDash, Bash, DoubleJump, Danger=95, Dash OR Launch

region LowerWastes:
  moki: Danger=50, Regenerate
  unsafe: free

anchor LowerWastes.WestTP at 1456, -3997:  # At the Western Wastes TP
  refill Full

  pickup LowerWastes.WestTPOre:
    moki: Burrow
  pickup WoodsMain.FeedingGroundsEX:
    moki: Burrow, DoubleJump OR Dash OR Glide OR Launch

  conn Teleporters: free
  conn LowerWastes.SunsetView:
    moki:
      DoubleJump, Grapple
      Bash, Grenade=1, DoubleJump OR Dash
      DoubleJump, Burrow
      Launch
  conn WoodsMain.FeedingGrounds:
    moki: WindtornRuins.Seir, Burrow  # Seir to make it a safe path
    unsafe: Burrow
  conn WeepingRidge.Bottom:
    moki, WindtornRuins.Seir:  # Seir to make it a safe path
      Burrow, DoubleJump, Glide, Grapple
      Burrow, Bash, Grenade=1, Glide, Grapple
      Burrow, DoubleJump, Bash, Grenade=1, Grapple
      Burrow, Launch

anchor LowerWastes.SunsetView at 1552, -3984:  # At the Sunset View checkpoint
  refill Checkpoint

  pickup LowerWastes.SunsetViewEX: free
  pickup LowerWastes.PurpleWallEX:
    moki: Burrow, Bash
  conn LowerWastes.WestTP:
    moki: DoubleJump OR Dash OR Glide OR Launch
  conn LowerWastes.Shovel:
    moki:  # I think this is fine without EnemyObstacle?
      Grapple, DoubleJump OR Dash OR Glide
      DoubleJump, Bash, Grenade=1 # Does require double jump to the grenade, and then double jump after bash to clear grapple section
      Launch  # Pretty free. Only difficulty is wall jumping pre-Launch to go over the grapples.

anchor LowerWastes.Shovel at 1634, -3981:  # On the ground to the left of the Sand Bridge
  refill Energy=3:
    moki, Weapon:
      DoubleJump OR Launch
      Bash, Grenade=1

  quest LowerWastes.EerieGem:
    moki: Burrow

  pickup LowerWastes.SandBridgeOre: free

  conn LowerWastes.SunsetView:
    moki: EnemyObstacle
  conn LowerWastes.TreeArea:
    moki: Burrow
  conn LowerWastes.SandPot:
    moki, EnemyObstacle:
      Hammer OR DoubleJump OR Burrow OR Launch
      Bash, Grenade=1

anchor LowerWastes.SandPot at 1726, -3990:  # At autosave to the left of Sand Pot
  refill Checkpoint

  pickup LowerWastes.MuncherTunnelEC:
    moki: Burrow
  pickup LowerWastes.SandPotHC:
    moki:
      Burrow  # should be fine for moki? It mostly works holding left with somewhat proper timing
      Launch
  pickup LowerWastes.SandPotEX:  # Duplicated pickup as paths differ.
    moki:
      Burrow, Dash, Grapple, DoubleJump OR Glide
      Burrow, Bash, Grenade=1
      Burrow, Launch

  conn LowerWastes.Shovel:
    moki:
      DoubleJump OR Launch
      Bash, Grenade=1
  conn LowerWastes.WoodenBridge:
    moki:
      Dash, DoubleJump OR Grapple
      Dash, Bash, Grenade=1
      Bash, Grenade=2, DoubleJump OR Glide
      Bash, Grenade=1, Grapple, DoubleJump OR Glide
      Bash, Grenade=1, DoubleJump, Glide
      Launch

anchor LowerWastes.WoodenBridge at 1796, -3977:  # Directly above MuncherPitEX
  refill Checkpoint

  pickup LowerWastes.SandPotEX:
    moki:
      Burrow, Grapple, DoubleJump OR Glide
      Burrow, Grapple, Bash, Grenade=1
      Burrow, Bash, Grenade=1, DoubleJump, Dash OR Glide
      Burrow, Launch
  pickup LowerWastes.MuncherPitEX:
    moki:
      DoubleJump  # Slightly precise to land on the sand sphere. Can always add glide
      Burrow, Glide  # Might be a little _too_ precise. I guess this is among the intended strats tho?
      Launch  # Still slightly precise.

  conn LowerWastes.SandPot:
    moki:
      Dash, DoubleJump OR Grapple
      Bash, Grenade=1, Grapple
      Bash, Grenade=1, DoubleJump, Glide
      Launch
  conn LowerWastes.LeverArea:
    moki:
      DoubleJump
      Burrow
      Launch

anchor LowerWastes.LeverArea at 1833, -3959:  # At the arrow sign below the lever
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  # So you may ask why this isn't part of WoodenBridge. It doesn't actually have to do with the lever, but more with the MinesEntrance anchor below and in particular the Health Cell. Effectively, without this anchor, that Health Cell would have pickup paths in three areas including EastTP and that's kinda bad.
  # This still probably wouldn't have been the choice if not for another reason: You can go through the Ruins back exit to here without a Weapon, and then have to Burrow through the ceiling, which requires this subarea to be represented without major dumb
  state LowerWastes.SandPlatformLever:
    moki:
      DoubleJump
      Burrow  # Requires a vertical burrow through a vertical sand platform
      Bash, Grenade=2
      Bash, Grenade=1, Dash
      Launch

  pickup LowerWastes.BottomRightHC:
    moki: free
  pickup LowerWastes.LastStandShard:
    moki:  # for the puzzle, it is considered solvable in moki with one of doublejump, dash or burrow.
      Bash, Grenade=1, DoubleJump
      Launch, DoubleJump OR Dash OR Burrow
      LowerWastes.SandPlatformLever, DoubleJump, Dash OR Glide OR Burrow  # If the double jump is too tight this makes it free
  pickup LowerWastes.LastStandEX:
    moki:
      Burrow, DoubleJump, Bash, Grenade=1
      Burrow, DoubleJump, LowerWastes.SandPlatformLever  # Requires a vertical burrow through a vertical sand platform
      Burrow, Launch
  pickup LowerWastes.MuncherClimbEX:
    moki:
      DoubleJump, Grapple, Bash, Grenade=1
      LowerWastes.SandPlatformLever, DoubleJump, Grapple, Dash OR Glide OR Burrow  # If the double jump is too tight this makes it free
      Grapple, Launch

  conn LowerWastes.WoodenBridge:
    moki: free
  conn LowerWastes.TreeArea:
    moki:
      DoubleJump, Grapple, Bash, Grenade=1
      Grapple, Launch
      LowerWastes.SandPlatformLever, DoubleJump, Grapple, Dash OR Glide OR Burrow  # If the double jump is too tight this makes it free
      LowerWastes.SandPlatformLever, Grapple, Dash, Glide, Burrow  # This path is fun. Glide is just to make it moki-safe
  conn LowerWastes.MinesEntrance:
    moki: EnemyObstacle, DoubleJump OR Dash OR Glide OR Grapple OR Launch
  conn LowerWastes.EastTP:
    moki: Burrow

anchor LowerWastes.MinesEntrance at 1921, -4001:  # To the left of the lower breakable wall
  pickup LowerWastes.BottomRightEX:
    moki, EnemyObstacle:
      Grapple
      Bash, Grenade=1, DoubleJump OR Dash  # Very much not a mandatory grenade... This is only important if the Ruins Wall is broken, and then only if you don't use the enemies
      Launch
  pickup LowerWastes.BottomRightHC:
    moki, EnemyObstacle:
      Grapple  # Use both Grapple points
      Bash, Grenade=1, DoubleJump OR Dash OR Glide
      Launch

  conn LowerWastes.WoodenBridge:
    moki, BreakWall=20:
      DoubleJump, Grapple
      Launch, DoubleJump OR Dash OR Grapple
  # connection back to lever seems to obscure for moki

anchor LowerWastes.TreeArea at 1715, -3936:  # The ledge right of SkeetoHive
  refill Checkpoint

  # state LowerWastes.TrialActivation:
  #   moki:
  #     Burrow, DoubleJump OR Dash OR Glide
  #     Burrow, Bash, Grenade=1
  #     DoubleJump, Bash, Grenade=2
  #     Dash, Bash, Grenade=4  # yes, good
  #     Launch

  quest LowerWastes.HandToHandMapstone:
    moki, GladesTown.HandToHandCanteen:
      DoubleJump
      Burrow
      Bash, Grenade=2  # literally never going to get used but you can do it
      Launch

  pickup LowerWastes.SkeetoHiveEX:
    moki: Burrow, DoubleJump OR Dash OR Glide OR Launch
  pickup LowerWastes.LupoMap:
    moki:
      Burrow
      Bash, Grenade=4  # literally never going to get used but you can do it
      Launch
  pickup LowerWastes.BurrowTree:
    moki:
      DoubleJump
      Burrow
      Bash, Grenade=2  # literally never going to get used but you can do it
      Launch
  pickup LowerWastes.BurrowTreeEX:
    moki: Burrow

  conn LowerWastes.Shovel:
    moki: Burrow
  conn LowerWastes.UpperPath:
    moki:
      Burrow, DoubleJump OR Launch
      Burrow, Bash, Grenade=1  # literally never going to get used but you can do it
      Burrow, Bash # unverified. Have to use a skeeto.
  conn LowerWastes.LeverArea:
    moki:
      Grapple, Launch
      Grapple, DoubleJump, Dash  # still sort of tight

anchor LowerWastes.UpperPath at 1761, -3898:  # on the left side of the path connecting tree and east teleporter
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  pickup LowerWastes.UpperPathEC:
    moki:
      Burrow, DoubleJump OR Dash OR Launch
      Burrow, Bash, Grenade=1
  pickup LowerWastes.UpperPathEX:
    moki:
      Burrow, DoubleJump OR Dash OR Launch
      Burrow, Bash, Grenade=1, Glide  # this is absolutely a necessary path
  pickup LowerWastes.UpperPathHiddenEX:
    moki: Burrow, DoubleJump OR Dash OR Launch

  conn LowerWastes.TreeArea:
    moki: Burrow
  conn LowerWastes.EastTP:
    moki:
      Burrow, DoubleJump OR Dash OR Launch
      Burrow, Bash, Grenade=1

anchor LowerWastes.EastTP at 1992, -3902:  # Location of the east teleporter
  refill Full

  pickup LowerWastes.EastTPOre:
    moki, BreakWall=20:
      Burrow OR Launch
      DoubleJump, Bash, Grenade=1
      Bash, Grenade=3  # it had to be done
  pickup LowerWastes.UpperPathHC:
    moki: Burrow

  conn Teleporters: free
  conn LowerWastes.LeverArea:
    moki: Burrow
  conn LowerWastes.UpperPath:
    moki: Burrow, DoubleJump OR Dash OR Launch
  conn UpperWastes.KeystoneRoom:
    moki: Burrow, DoubleJump OR Dash OR Launch 

region UpperWastes:
  moki: Danger=50, Regenerate
  unsafe: free

anchor UpperWastes.KeystoneRoom at 1900, -3831:  # Autosave underneath keystone door
  refill Checkpoint

  state UpperWastes.KeystoneDoor:
    moki, Keystone=2:
      Burrow, DoubleJump OR Dash OR Glide
      Launch

  pickup UpperWastes.LowerKS:
    moki:
      Burrow, DoubleJump OR Dash OR Glide
      Launch, DoubleJump OR Dash OR Glide
  pickup UpperWastes.UpperKS:
    moki: Burrow, DoubleJump OR Dash OR Glide OR Launch
  pickup UpperWastes.TurmoilShard:
    moki:  # this area seems a bit hard, not sure what intended is like.
      Bash, Burrow, DoubleJump, Dash  # intended way?
      Bash, Burrow, Launch
  pickup UpperWastes.KSDoorEX:
    moki:
      Burrow, DoubleJump OR Dash OR Glide
      DoubleJump, Bash, Grenade=1
      Launch

  conn LowerWastes.EastTP:
    moki: Burrow, DoubleJump OR Dash OR Glide OR Launch
  conn UpperWastes.MissilePuzzleLeft:
    moki: UpperWastes.KeystoneDoor, Burrow, DoubleJump OR Dash OR Glide OR Launch

anchor UpperWastes.MissilePuzzleLeft at 1937, -3794:  # Immediately to the right of the sand after the keystone door
  refill Checkpoint

  # don't really need a state for purple wall, it can be broken from either side
  state UpperWastes.MissilePuzzleLever:  # for now, this state also means that both purple walls blocking the lever have been broken. If ways to pull the lever without breaking them are found, paths using this may have to change
    moki: Bash, Burrow

  pickup UpperWastes.LedgeEC:
    moki:
      Bash, Burrow, DoubleJump OR Dash
      Launch
  pickup UpperWastes.MissileSpawnEX:
    moki: Burrow
  pickup UpperWastes.PurpleWallEX:
    moki: Weapon, Burrow  # Putting Weapon here rather than EnemyObstacle because Launch really doesnt help you with this Gorlek.
  pickup UpperWastes.KSDoorEX:
    moki: Burrow
  pickup UpperWastes.PurpleWallHC:
    moki: Burrow, UpperWastes.MissilePuzzleLever

  conn UpperWastes.KeystoneRoom:
    moki: UpperWastes.KeystoneDoor, Burrow
  conn UpperWastes.MissilePuzzleRight:
    moki: UpperWastes.MissilePuzzleLever, Burrow

anchor UpperWastes.MissilePuzzleRight at 2058, -3813: # On top of sand to the right of lever gate, underneath a laser.
  pickup UpperWastes.PurpleWallHC:
    moki: Burrow
  pickup UpperWastes.RoofEX:
    moki:
      Burrow, DoubleJump, Bash, Grenade=1, Glide  # glide for the lasers
      Burrow, DoubleJump, Dash  # you can retry the burrow with DoubleJump, so I think this is fine
      Burrow, Launch

  conn UpperWastes.MissilePuzzleLeft:
    moki: UpperWastes.MissilePuzzleLever, Burrow
  conn UpperWastes.RuinsApproach:  # this covers all connections to the pickups in the spinning lasers.
    moki:
      Burrow, Bash, DoubleJump, Dash OR Glide  # dash or glide to make the lasers better
      Burrow, DoubleJump, Dash  # you can retry the burrow with DoubleJump, so I think this is fine
      Burrow, Launch

anchor UpperWastes.NorthTP at 2044, -3679: # North Wastes teleporter
  refill Full

  conn Teleporters: free
  conn UpperWastes.RuinsApproach: free

anchor UpperWastes.RuinsApproach at 2002, -3684:  # Left of the teleporter, on top of the sand
  refill Full:  # use the teleporter
    moki:
      DoubleJump, Bash
      Burrow OR Launch

  quest UpperWastes.FlowersSeed:
    moki:
      Burrow, Bash, Glide, DoubleJump OR Dash  # Dash variant slightly precise if you do it without the enemies... but you can also do it using the enemies
      Burrow, Launch  # maybe Glide? I think this is fine tho
      Bash, Launch

  pickup UpperWastes.SpinLasersRightEX:
    moki: Burrow
  pickup UpperWastes.SpinLasersMiddleEX:
    moki: Burrow
  pickup UpperWastes.SpinLasersLowerEX:
    moki: Burrow
  pickup UpperWastes.RoofEX:
    moki:
      Burrow, DoubleJump, Bash, Grenade=1
      Burrow, DoubleJump, Dash OR Glide
      Burrow, Launch
  pickup UpperWastes.WallOre:
    moki:
      Burrow, Bash, DoubleJump, Dash OR Glide
      Burrow, Bash, Dash, Glide  # Slightly tight getting across to the sand pit but pretty easily doable. Semi precise angle on the burrow but with glide its easy to reattempt
      Bash, Launch, DoubleJump OR Dash OR Glide OR Burrow
      Burrow, Launch, DoubleJump OR Glide

  conn UpperWastes.MissilePuzzleRight:
    moki: Burrow, DoubleJump OR Launch
  conn WindtornRuins.UpperRuinsDoor:
    moki, UpperDepths.ForestsEyes, WestPools.ForestsStrength, LowerReach.ForestsMemory:
      Bash, Launch
      Burrow, Launch, DoubleJump OR Glide  # djump or glide lets you reattempt
      Burrow, Bash, DoubleJump, Dash OR Glide
      Burrow, Bash, Dash, Glide  # Slightly tight getting across to the sand pit but pretty easily doable. Semi precise angle on the burrow but with glide its easy to reattempt
  conn UpperWastes.NorthTP:
    moki:
      DoubleJump, Bash
      Burrow OR Launch

anchor WindtornRuins.UpperRuinsDoor at 2163, -3835:  # Just inside the door.
  refill Checkpoint
  refill Energy=3:
    moki: Weapon

  state WindtornRuins.RuinsLever:
    moki: Burrow, BreakWall=16  # just being safe here
  state WindtornRuins.HeartBarrier:  # These are paths to go to the teleporter and break the corruption heart. But they can't originate from the teleporter anchor because after you broke the heart, you can't go to the teleporter again, which makes these paths not viable as connections to the teleporter. These paths are just about breaking the heart, so it doesn't matter if the paths can lock you out of the teleporter if you already have broken the heart, because then you have already broken the heart.
    moki, WindtornRuins.RuinsLever, BreakWall=16:
      Burrow, DoubleJump OR Dash OR Glide OR Launch
      Burrow, Bash, Grenade=1

  pickup UpperWastes.FlowersSeed: free
  pickup UpperWastes.WallOre:
    moki:
      Bash, Grenade=1, Glide
      Launch, DoubleJump OR Glide

  conn UpperWastes.RuinsApproach: free
  # higher difficulties can put connections to northtp here
  conn WindtornRuins.RuinsTP:  # connection FROM entrance TO tp at ANY TIME
    # this accounts for both situations of having broken the heart or not
    moki, WindtornRuins.RuinsLever:
      Burrow, Dash, DoubleJump
      Burrow, DoubleJump, Glide
      Burrow, Bash, Grenade=1, Glide
      Burrow, Launch
  conn WindtornRuins.Escape:  # connection FROM entrance TO escape to support future paths of breaking the heart without reaching the teleporter
    moki: WindtornRuins.RuinsLever, WindtornRuins.HeartBarrier, Burrow
  conn WindtornRuins.LowerRuins:  # connection FROM entrance TO lower AFTER escape
    # if you completed the escape, there's a gap in the floor that you have to cross, but Burrow alone is enough to do so
    # Since Burrow solves this connection, it accounts for all paths to the escape revisit pickup
    moki: WindtornRuins.RuinsLever, WindtornRuins.HeartBarrier, WindtornRuins.Seir, Burrow

anchor WindtornRuins.RuinsTP at 2130, -3984:  # Windtorn Ruins teleporter.
  refill Full

  state WindtornRuins.HeartBarrier:  # Barrier next to the teleporter that stops you from getting the Heart.
    moki: BreakWall=16

  conn Teleporters: free
  conn WindtornRuins.Escape:  # connection FROM tp TO escape
    # the gap after completing the escape locks you out of these paths, but it doesn't matter because they're only relevant for completing the uncompleted escape
    moki: WindtornRuins.HeartBarrier
  conn WindtornRuins.LowerRuins:  # connection FROM tp TO lower ruins AFTER escape
    # if you completed the escape, there's a gap in the floor that you have to cross
    # Since Burrow solves this connection, it accounts for all paths to the escape revisit pickup
    moki, WindtornRuins.HeartBarrier, WindtornRuins.Seir:
      DoubleJump OR Dash OR Glide OR Burrow OR Launch
      Bash, Grenade=1  # yes, this needs a bashgrenade path
  conn WindtornRuins.UpperRuinsDoor:
    moki, WindtornRuins.RuinsLever:
      # these account for both situations of having broken the heart or not
      Burrow, Bash, Grenade=1, DoubleJump OR Dash
      Burrow, Glide, DoubleJump OR Dash
      Burrow, Launch
      # these make you able to break the Heart and then use the resulting terrain
      Weapon, Burrow, Bash, Grenade=1
      Weapon, Glide

anchor WindtornRuins.Escape:
  refill Full
  # (yes, this has to exist apparently, because you can access the escape from all the different anchors in ruins)
  # After you complete the escape, there's a gap in the floor to its right, making the location unreachable with skillsets
  # that would have reached it before completing the escape. That's why this has no outside connections; the paths to here 
  # can softlock after achieving the EscapeComplete state, so this anchor is only safe as long as it does nothing else than handling that state.
  quest WindtornRuins.Seir:
    moki, WindtornRuins.HeartBarrier:
      Burrow, Dash, Grapple, DoubleJump OR Glide
      Burrow, DoubleJump, Glide, Grapple  # I think this is fine?
      Burrow, DoubleJump, Launch, Dash OR Glide
      Burrow, Grapple, Launch, Glide

anchor WindtornRuins.LowerRuins at 1969, -4024:  # At the ancient map pedestal
  # requires escape to be done
  quest WindtornRuins.HandToHandComplete:
    moki: LowerWastes.HandToHandMapstone

  pickup WindtornRuins.EscapeRevisitEC:
    moki: WindtornRuins.Seir, Burrow
  conn WindtornRuins.Escape: free  # walk over the invisible sandworm
  conn WindtornRuins.RuinsTP:
    moki, WindtornRuins.HeartBarrier, WindtornRuins.Seir:
      Burrow, Dash, DoubleJump
      Burrow, DoubleJump, Glide
      Burrow, Bash, Glide, Grenade=2
      Launch
  # connection to upper should be redundant with the conn to tp?

  conn LowerWastes.MinesEntrance:
    moki: Burrow, BreakWall=20

region WeepingRidge:
  moki: Danger=60, Regenerate
  unsafe: free

anchor WeepingRidge.Bottom at 1210, -3830:  # After crossing the portal to weeping ridge
  refill Checkpoint
  refill Health=1: free
  refill Energy=3:
    moki:
      Weapon, DoubleJump OR Burrow OR Launch
      Bow=1

  state WeepingRidge.ElevatorFightCompleted:
    moki, Combat, Bash OR Hammer OR Launch:  # against the shields
      DoubleJump, Dash OR Glide
      Bash, Grenade=1
      Launch

  conn WeepingRidge.LaunchArea:
    moki, WeepingRidge.ElevatorFightCompleted:
      DoubleJump, Dash OR Glide
      Bash, Grenade=1
      Launch
  conn LowerWastes.WestTP:
    moki: WindtornRuins.Seir, Burrow  # Seir to make it a safe path

anchor WeepingRidge.LaunchArea at 1189, -3716:  # After the portal at the top of the elevator
  refill Checkpoint
  refill Health=1: free

  pickup WeepingRidge.LaunchTree:
    moki:
      Glide
      Launch, Bash OR DoubleJump OR Dash
    unsafe:
      Launch                    # tricky!
      Bash, DoubleJump, Dash    # also kinda tricky?
  pickup WeepingRidge.PortalEX:
    moki: Launch, Glide OR Bash OR DoubleJump OR Dash
    unsafe: Launch
  pickup WeepingRidge.SpikeClimbEX:
    moki: Launch, Glide OR Bash OR DoubleJump OR Dash
    unsafe: Launch
  pickup WeepingRidge.Ore:
    moki: Launch, DoubleJump OR Bash
    unsafe:
      Launch
      Bash, Glide              # fuck with the elemental until he gives you a shot to bash

  conn WillowsEnd.Entry:
    moki: WeepingRidge.ElevatorFightCompleted, Launch, DoubleJump, Dash OR Glide
    unsafe: WeepingRidge.ElevatorFightCompleted, Launch, DoubleJump OR Glide OR Dash # you really only NEED one of the 3 of em
  conn WeepingRidge.Bottom:
    moki, WeepingRidge.ElevatorFightCompleted:
      Bash, Grenade=1
      Launch

region WillowsEnd:
  moki: Danger=60, Regenerate  # need more than 6 health and Regen to do ANYTHING in willow
  unsafe: free

anchor WillowsEnd.Entry at 495, -3951:  # At the lower door
  refill Checkpoint
  refill Energy=4:
    moki:
      Weapon, Launch
      Bow=1
  # a lot of energy crystals not considered, mostly because they are on the way to hearts which aren't currently tracked

  # state WillowsEnd.TrapHeart:
  #   moki: BreakWall=30, RangedWeapon, Launch, DoubleJump, Dash

  # state WillowsEnd.GrappleWheelsHeart:
  #   moki, BreakWall=30:
  #     Grapple, Launch, DoubleJump, Dash
  #     Grapple, Launch, Glide

  pickup WillowsEnd.SpikesOre:
    moki: Launch, Dash OR Glide
  pickup WillowsEnd.EntryEX:
    moki:
      DoubleJump, Bash, Grenade=2
      Launch
  pickup WillowsEnd.PoisonfallHC:
    moki:
      Grapple, Launch, DoubleJump, Dash
      Grapple, Launch, Glide
      WillowsEnd.GrappleWheelsHeart, DoubleJump, Bash, Grenade=2, Dash OR Glide
      WillowsEnd.GrappleWheelsHeart, Launch

  conn WillowsEnd.InnerTP:
    moki: Launch, Bash, DoubleJump OR Dash OR Glide  # mine in the way, but I think it's managable

anchor WillowsEnd.InnerTP at 422, -3864:  # The teleporter inside
  refill Full

  pickup WillowsEnd.LupoMap:
    moki: DoubleJump OR Dash OR Launch OR RangedWeapon

  conn Teleporters: free
  conn WillowsEnd.Entry:
    moki:
      BreakWall=20  # open the portal shortcut
      DoubleJump, Dash
      Glide OR Launch
  conn WillowsEnd.AboveInnerTP:
    moki:
      DoubleJump, Bash, Grenade=1, Dash OR Glide
      Launch, DoubleJump OR Dash

anchor WillowsEnd.AboveInnerTP at 530, -3844:  # at the lava pit before bash puzzle
  refill Checkpoint
  refill Energy=4:
    moki:
      Weapon, Launch
      EnemyObstacle, Bow=1

  conn WillowsEnd.InnerTP:
    moki: EnemyObstacle
  conn WillowsEnd.East:
    moki:
      DoubleJump, Bash, Grenade=1, Dash OR Glide
      Launch, DoubleJump OR Dash

anchor WillowsEnd.East at 547, -3805:  # To the left of the redirect puzzle
  refill Health=1:
    moki:
      Bash, DoubleJump OR Dash OR Glide
      Launch
  refill Energy=4:
    moki:
      Weapon, Bash, DoubleJump OR Glide
      Bow=1, Bash, DoubleJump OR Dash OR Glide
      Weapon, Launch
      Bow=1, Launch

  # state WillowsEnd.RedirectHeart:
  #   moki: BreakWall=10, BreakWall=30, DoubleJump, Bash, Launch

  pickup WillowsEnd.RedirectEX:
    moki:
      BreakWall=10, Bash, Launch, DoubleJump OR Dash OR Glide
      Bash, Grenade=1, Launch

  conn WillowsEnd.AboveInnerTP:
    moki:
      Glide
      Bash, DoubleJump, Dash
      Launch, DoubleJump OR Dash OR Bash
  conn WillowsEnd.Upper:
    moki: Bash, Launch  # some other paths would be possible, but with how far back the last checkpoint is...

anchor WillowsEnd.West at 437, -3840:  # To the left of the one-way above Lupo
  refill Checkpoint
  refill Energy=4:
    moki: Weapon

  # state WillowsEnd.SpinLasersHeart:
  #   moki: BreakWall=30, Launch, DoubleJump OR Dash OR Glide

  conn WillowsEnd.InnerTP:
    moki: BreakWall=20
  conn WillowsEnd.Upper:
    moki, BreakWall=10:  # enemy can mess you up... players will be fine, right?
      Bash, Grenade=1, DoubleJump OR Dash OR Glide
      Launch
  conn WillowsEnd.GlideHeartPath:
    moki: DoubleJump, Launch

anchor WillowsEnd.GlideHeartPath at 360, -3861:  # Before the last two rooms
  refill Checkpoint
  refill Energy=4:
    moki:
      Weapon, Launch
      Bow=1

  # state WillowsEnd.GlideHeart:
  #   moki: BreakWall=30, DoubleJump, Glide, Launch

  pickup WillowsEnd.WindSpinOre:
    moki: Glide

  conn WillowsEnd.West: free  # :D

anchor WillowsEnd.Upper at 499, -3748:  # At the upper door
  refill Checkpoint
  refill Energy=4:  # on the way to burrow heart
    unsafe: Weapon, Bash OR Launch

  # state WillowsEnd.BurrowHeart:
  #   moki, BreakWall=30:
  #     Burrow, DoubleJump, Dash, Bash, Grapple, Glide
  #     Burrow, Bash, Grapple, Launch, DoubleJump OR Glide

  # conn LaserRockFight:
  #   moki:
  #     Launch, DoubleJump
  #     Launch, Dash, Glide
  conn WillowsEnd.East:
    moki: EnemyObstacle, DoubleJump OR Dash OR Bash OR Glide OR Launch
  conn WillowsEnd.West:
    moki: Launch
  conn WillowsEnd.UpperHeartPath:
    moki:
      RangedWeapon, DoubleJump, Bash, Grenade=1
      Launch

# anchor LaserRockFight:
#   refill Full
#   state WillowsEnd.ElementalDefeated:
#     moki: Combat, Danger=85, Bash, Launch

anchor WillowsEnd.UpperHeartPath at 506, -3711:  # Right above the exit blocked by vines
  refill Checkpoint
  refill Energy=4:
    moki:
      Weapon, Launch
      Bow=1

  # state WillowsEnd.SpinPortalsHeart:
  #   moki, BreakWall=30:
  #     Bash, Grapple, Launch, DoubleJump, Dash
  #     Bash, Grapple, Launch, Glide

  pickup WillowsEnd.UpperLeftEX:
    moki: Grapple, Launch, DoubleJump OR Dash OR Glide
  pickup WillowsEnd.UpperRightEX:
    moki:
      Bash, Grapple, Launch, DoubleJump, Dash
      Bash, Grapple, Launch, Glide

  conn WillowsEnd.Upper: free

anchor TwillenShop:
  quest GladesTown.ADiamondInTheRough:
    moki: LowerWastes.EerieGem

  pickup TwillenShop.Overcharge:
    moki: SpiritLight=1200
  pickup TwillenShop.Wingclip:
    moki: SpiritLight=1200
  pickup TwillenShop.Swap:
    moki: SpiritLight=1200
  pickup TwillenShop.Vitality:
    moki: SpiritLight=1200
  pickup TwillenShop.Energy:
    moki: SpiritLight=1200
  pickup TwillenShop.Finesse:
    moki: SpiritLight=1200
  pickup TwillenShop.TripleJump:
    moki: GladesTown.EntryWallBroken, SpiritLight=1200
  pickup TwillenShop.LightHarvest:
    moki: GladesTown.EntryWallBroken, SpiritLight=1200

anchor OpherShop:
  pickup OpherShop.Spike:
    moki: SpiritLight=1200
  pickup OpherShop.SpiritSmash:
    moki: SpiritLight=1200
  pickup OpherShop.SpiritStar:
    moki: SpiritLight=1200
  pickup OpherShop.Blaze:
    moki: SpiritLight=1200
  pickup OpherShop.Sentry: # used for keystones if necessary; filtered by gen
    moki: SpiritLight=1200
  pickup OpherShop.Teleport:
    moki: GladesTown.EntryWallBroken, SpiritLight=1200
  pickup OpherShop.WaterBreath:
    moki: InnerWellspring.WaterEscape, EastHollow.Voice, SpiritLight=1200

anchor TuleyShop:
  quest GladesTown.RegrowTheGlades:
    moki: TuleyShop.SelaFlowers, TuleyShop.StickyGrass, TuleyShop.Lightcatchers, TuleyShop.BlueMoon, TuleyShop.SpringPlants, TuleyShop.LastTree

  state TuleyShop.LastTreeBranchRejected:  # written out the steps in case they give pickups
    moki: WoodsEntry.LastTreeBranch
  state TuleyShop.SelaFlowers:
    moki: UpperWastes.FlowersSeed
  state TuleyShop.StickyGrass:
    moki: EastPools.GrassSeed
  state TuleyShop.Lightcatchers:
    moki: UpperDepths.LightcatcherSeed
  state TuleyShop.BlueMoon:
    moki: InnerWellspring.BlueMoonSeed
  state TuleyShop.SpringPlants:
    moki: UpperReach.SpringSeed
  state TuleyShop.LastTree:
    moki: WoodsEntry.TreeSeed


# do not delete the newline at the end of the file